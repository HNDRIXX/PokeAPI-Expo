802257e0f53747bea3e800ab502cb6de
'use strict';

exports.__esModule = true;
exports.computeWindowedRenderLimits = computeWindowedRenderLimits;
exports.elementsThatOverlapOffsets = elementsThatOverlapOffsets;
exports.newRangeCount = newRangeCount;
exports.default = void 0;
var _invariant = _interopRequireDefault(require("fbjs/lib/invariant"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
function elementsThatOverlapOffsets(offsets, itemCount, getFrameMetrics) {
  var out = [];
  var outLength = 0;
  for (var ii = 0; ii < itemCount; ii++) {
    var frame = getFrameMetrics(ii);
    var trailingOffset = frame.offset + frame.length;
    for (var kk = 0; kk < offsets.length; kk++) {
      if (out[kk] == null && trailingOffset >= offsets[kk]) {
        out[kk] = ii;
        outLength++;
        if (kk === offsets.length - 1) {
          (0, _invariant.default)(outLength === offsets.length, 'bad offsets input, should be in increasing order: %s', JSON.stringify(offsets));
          return out;
        }
      }
    }
  }
  return out;
}
function newRangeCount(prev, next) {
  return next.last - next.first + 1 - Math.max(0, 1 + Math.min(next.last, prev.last) - Math.max(next.first, prev.first));
}
function computeWindowedRenderLimits(props, prev, getFrameMetricsApprox, scrollMetrics) {
  var data = props.data,
    getItemCount = props.getItemCount,
    maxToRenderPerBatch = props.maxToRenderPerBatch,
    windowSize = props.windowSize;
  var itemCount = getItemCount(data);
  if (itemCount === 0) {
    return prev;
  }
  var offset = scrollMetrics.offset,
    velocity = scrollMetrics.velocity,
    visibleLength = scrollMetrics.visibleLength;
  var visibleBegin = Math.max(0, offset);
  var visibleEnd = visibleBegin + visibleLength;
  var overscanLength = (windowSize - 1) * visibleLength;
  var leadFactor = 0.5;
  var fillPreference = velocity > 1 ? 'after' : velocity < -1 ? 'before' : 'none';
  var overscanBegin = Math.max(0, visibleBegin - (1 - leadFactor) * overscanLength);
  var overscanEnd = Math.max(0, visibleEnd + leadFactor * overscanLength);
  var lastItemOffset = getFrameMetricsApprox(itemCount - 1).offset;
  if (lastItemOffset < overscanBegin) {
    return {
      first: Math.max(0, itemCount - 1 - maxToRenderPerBatch),
      last: itemCount - 1
    };
  }
  var _elementsThatOverlapO = elementsThatOverlapOffsets([overscanBegin, visibleBegin, visibleEnd, overscanEnd], props.getItemCount(props.data), getFrameMetricsApprox),
    overscanFirst = _elementsThatOverlapO[0],
    first = _elementsThatOverlapO[1],
    last = _elementsThatOverlapO[2],
    overscanLast = _elementsThatOverlapO[3];
  overscanFirst = overscanFirst == null ? 0 : overscanFirst;
  first = first == null ? Math.max(0, overscanFirst) : first;
  overscanLast = overscanLast == null ? itemCount - 1 : overscanLast;
  last = last == null ? Math.min(overscanLast, first + maxToRenderPerBatch - 1) : last;
  var visible = {
    first: first,
    last: last
  };
  var newCellCount = newRangeCount(prev, visible);
  while (true) {
    if (first <= overscanFirst && last >= overscanLast) {
      break;
    }
    var maxNewCells = newCellCount >= maxToRenderPerBatch;
    var firstWillAddMore = first <= prev.first || first > prev.last;
    var firstShouldIncrement = first > overscanFirst && (!maxNewCells || !firstWillAddMore);
    var lastWillAddMore = last >= prev.last || last < prev.first;
    var lastShouldIncrement = last < overscanLast && (!maxNewCells || !lastWillAddMore);
    if (maxNewCells && !firstShouldIncrement && !lastShouldIncrement) {
      break;
    }
    if (firstShouldIncrement && !(fillPreference === 'after' && lastShouldIncrement && lastWillAddMore)) {
      if (firstWillAddMore) {
        newCellCount++;
      }
      first--;
    }
    if (lastShouldIncrement && !(fillPreference === 'before' && firstShouldIncrement && firstWillAddMore)) {
      if (lastWillAddMore) {
        newCellCount++;
      }
      last++;
    }
  }
  if (!(last >= first && first >= 0 && last < itemCount && first >= overscanFirst && last <= overscanLast && first <= visible.first && last >= visible.last)) {
    throw new Error('Bad window calculation ' + JSON.stringify({
      first: first,
      last: last,
      itemCount: itemCount,
      overscanFirst: overscanFirst,
      overscanLast: overscanLast,
      visible: visible
    }));
  }
  return {
    first: first,
    last: last
  };
}
var VirtualizeUtils = {
  computeWindowedRenderLimits: computeWindowedRenderLimits,
  elementsThatOverlapOffsets: elementsThatOverlapOffsets,
  newRangeCount: newRangeCount
};
var _default = VirtualizeUtils;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyIsImVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzIiwibmV3UmFuZ2VDb3VudCIsImRlZmF1bHQiLCJfaW52YXJpYW50IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJvYmoiLCJvZmZzZXRzIiwiaXRlbUNvdW50IiwiZ2V0RnJhbWVNZXRyaWNzIiwib3V0Iiwib3V0TGVuZ3RoIiwiaWkiLCJmcmFtZSIsInRyYWlsaW5nT2Zmc2V0Iiwib2Zmc2V0IiwibGVuZ3RoIiwia2siLCJKU09OIiwic3RyaW5naWZ5IiwicHJldiIsIm5leHQiLCJsYXN0IiwiZmlyc3QiLCJNYXRoIiwibWF4IiwibWluIiwicHJvcHMiLCJnZXRGcmFtZU1ldHJpY3NBcHByb3giLCJzY3JvbGxNZXRyaWNzIiwiZGF0YSIsImdldEl0ZW1Db3VudCIsIm1heFRvUmVuZGVyUGVyQmF0Y2giLCJ3aW5kb3dTaXplIiwidmVsb2NpdHkiLCJ2aXNpYmxlTGVuZ3RoIiwidmlzaWJsZUJlZ2luIiwidmlzaWJsZUVuZCIsIm92ZXJzY2FuTGVuZ3RoIiwibGVhZEZhY3RvciIsImZpbGxQcmVmZXJlbmNlIiwib3ZlcnNjYW5CZWdpbiIsIm92ZXJzY2FuRW5kIiwibGFzdEl0ZW1PZmZzZXQiLCJfZWxlbWVudHNUaGF0T3ZlcmxhcE8iLCJvdmVyc2NhbkZpcnN0Iiwib3ZlcnNjYW5MYXN0IiwidmlzaWJsZSIsIm5ld0NlbGxDb3VudCIsIm1heE5ld0NlbGxzIiwiZmlyc3RXaWxsQWRkTW9yZSIsImZpcnN0U2hvdWxkSW5jcmVtZW50IiwibGFzdFdpbGxBZGRNb3JlIiwibGFzdFNob3VsZEluY3JlbWVudCIsIkVycm9yIiwiVmlydHVhbGl6ZVV0aWxzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyA9IGNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cztcbmV4cG9ydHMuZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMgPSBlbGVtZW50c1RoYXRPdmVybGFwT2Zmc2V0cztcbmV4cG9ydHMubmV3UmFuZ2VDb3VudCA9IG5ld1JhbmdlQ291bnQ7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfaW52YXJpYW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiZmJqcy9saWIvaW52YXJpYW50XCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyoqXG4gKiBVc2VkIHRvIGZpbmQgdGhlIGluZGljZXMgb2YgdGhlIGZyYW1lcyB0aGF0IG92ZXJsYXAgdGhlIGdpdmVuIG9mZnNldHMuIFVzZWZ1bCBmb3IgZmluZGluZyB0aGVcbiAqIGl0ZW1zIHRoYXQgYm91bmQgZGlmZmVyZW50IHdpbmRvd3Mgb2YgY29udGVudCwgc3VjaCBhcyB0aGUgdmlzaWJsZSBhcmVhIG9yIHRoZSBidWZmZXJlZCBvdmVyc2NhblxuICogYXJlYS5cbiAqL1xuZnVuY3Rpb24gZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHMob2Zmc2V0cywgaXRlbUNvdW50LCBnZXRGcmFtZU1ldHJpY3MpIHtcbiAgdmFyIG91dCA9IFtdO1xuICB2YXIgb3V0TGVuZ3RoID0gMDtcblxuICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgaXRlbUNvdW50OyBpaSsrKSB7XG4gICAgdmFyIGZyYW1lID0gZ2V0RnJhbWVNZXRyaWNzKGlpKTtcbiAgICB2YXIgdHJhaWxpbmdPZmZzZXQgPSBmcmFtZS5vZmZzZXQgKyBmcmFtZS5sZW5ndGg7XG5cbiAgICBmb3IgKHZhciBrayA9IDA7IGtrIDwgb2Zmc2V0cy5sZW5ndGg7IGtrKyspIHtcbiAgICAgIGlmIChvdXRba2tdID09IG51bGwgJiYgdHJhaWxpbmdPZmZzZXQgPj0gb2Zmc2V0c1tra10pIHtcbiAgICAgICAgb3V0W2trXSA9IGlpO1xuICAgICAgICBvdXRMZW5ndGgrKztcblxuICAgICAgICBpZiAoa2sgPT09IG9mZnNldHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICgwLCBfaW52YXJpYW50LmRlZmF1bHQpKG91dExlbmd0aCA9PT0gb2Zmc2V0cy5sZW5ndGgsICdiYWQgb2Zmc2V0cyBpbnB1dCwgc2hvdWxkIGJlIGluIGluY3JlYXNpbmcgb3JkZXI6ICVzJywgSlNPTi5zdHJpbmdpZnkob2Zmc2V0cykpO1xuICAgICAgICAgIHJldHVybiBvdXQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0O1xufVxuLyoqXG4gKiBDb21wdXRlcyB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBgbmV4dGAgcmFuZ2UgdGhhdCBhcmUgbmV3IGNvbXBhcmVkIHRvIHRoZSBgcHJldmAgcmFuZ2UuXG4gKiBIYW5keSBmb3IgY2FsY3VsYXRpbmcgaG93IG1hbnkgbmV3IGl0ZW1zIHdpbGwgYmUgcmVuZGVyZWQgd2hlbiB0aGUgcmVuZGVyIHdpbmRvdyBjaGFuZ2VzIHNvIHdlXG4gKiBjYW4gcmVzdHJpY3QgdGhlIG51bWJlciBvZiBuZXcgaXRlbXMgcmVuZGVyIGF0IG9uY2Ugc28gdGhhdCBjb250ZW50IGNhbiBhcHBlYXIgb24gdGhlIHNjcmVlblxuICogZmFzdGVyLlxuICovXG5cblxuZnVuY3Rpb24gbmV3UmFuZ2VDb3VudChwcmV2LCBuZXh0KSB7XG4gIHJldHVybiBuZXh0Lmxhc3QgLSBuZXh0LmZpcnN0ICsgMSAtIE1hdGgubWF4KDAsIDEgKyBNYXRoLm1pbihuZXh0Lmxhc3QsIHByZXYubGFzdCkgLSBNYXRoLm1heChuZXh0LmZpcnN0LCBwcmV2LmZpcnN0KSk7XG59XG4vKipcbiAqIEN1c3RvbSBsb2dpYyBmb3IgZGV0ZXJtaW5pbmcgd2hpY2ggaXRlbXMgc2hvdWxkIGJlIHJlbmRlcmVkIGdpdmVuIHRoZSBjdXJyZW50IGZyYW1lIGFuZCBzY3JvbGxcbiAqIG1ldHJpY3MsIGFzIHdlbGwgYXMgdGhlIHByZXZpb3VzIHJlbmRlciBzdGF0ZS4gVGhlIGFsZ29yaXRobSBtYXkgZXZvbHZlIG92ZXIgdGltZSwgYnV0IGdlbmVyYWxseVxuICogcHJpb3JpdGl6ZXMgdGhlIHZpc2libGUgYXJlYSBmaXJzdCwgdGhlbiBleHBhbmRzIHRoYXQgd2l0aCBvdmVyc2NhbiByZWdpb25zIGFoZWFkIGFuZCBiZWhpbmQsXG4gKiBiaWFzZWQgaW4gdGhlIGRpcmVjdGlvbiBvZiBzY3JvbGwuXG4gKi9cblxuXG5mdW5jdGlvbiBjb21wdXRlV2luZG93ZWRSZW5kZXJMaW1pdHMocHJvcHMsIHByZXYsIGdldEZyYW1lTWV0cmljc0FwcHJveCwgc2Nyb2xsTWV0cmljcykge1xuICB2YXIgZGF0YSA9IHByb3BzLmRhdGEsXG4gICAgICBnZXRJdGVtQ291bnQgPSBwcm9wcy5nZXRJdGVtQ291bnQsXG4gICAgICBtYXhUb1JlbmRlclBlckJhdGNoID0gcHJvcHMubWF4VG9SZW5kZXJQZXJCYXRjaCxcbiAgICAgIHdpbmRvd1NpemUgPSBwcm9wcy53aW5kb3dTaXplO1xuICB2YXIgaXRlbUNvdW50ID0gZ2V0SXRlbUNvdW50KGRhdGEpO1xuXG4gIGlmIChpdGVtQ291bnQgPT09IDApIHtcbiAgICByZXR1cm4gcHJldjtcbiAgfVxuXG4gIHZhciBvZmZzZXQgPSBzY3JvbGxNZXRyaWNzLm9mZnNldCxcbiAgICAgIHZlbG9jaXR5ID0gc2Nyb2xsTWV0cmljcy52ZWxvY2l0eSxcbiAgICAgIHZpc2libGVMZW5ndGggPSBzY3JvbGxNZXRyaWNzLnZpc2libGVMZW5ndGg7IC8vIFN0YXJ0IHdpdGggdmlzaWJsZSBhcmVhLCB0aGVuIGNvbXB1dGUgbWF4aW11bSBvdmVyc2NhbiByZWdpb24gYnkgZXhwYW5kaW5nIGZyb20gdGhlcmUsIGJpYXNlZFxuICAvLyBpbiB0aGUgZGlyZWN0aW9uIG9mIHNjcm9sbC4gVG90YWwgb3ZlcnNjYW4gYXJlYSBpcyBjYXBwZWQsIHdoaWNoIHNob3VsZCBjYXAgbWVtb3J5IGNvbnN1bXB0aW9uXG4gIC8vIHRvby5cblxuICB2YXIgdmlzaWJsZUJlZ2luID0gTWF0aC5tYXgoMCwgb2Zmc2V0KTtcbiAgdmFyIHZpc2libGVFbmQgPSB2aXNpYmxlQmVnaW4gKyB2aXNpYmxlTGVuZ3RoO1xuICB2YXIgb3ZlcnNjYW5MZW5ndGggPSAod2luZG93U2l6ZSAtIDEpICogdmlzaWJsZUxlbmd0aDsgLy8gQ29uc2lkZXJpbmcgdmVsb2NpdHkgc2VlbXMgdG8gaW50cm9kdWNlIG1vcmUgY2h1cm4gdGhhbiBpdCdzIHdvcnRoLlxuXG4gIHZhciBsZWFkRmFjdG9yID0gMC41OyAvLyBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCB2ZWxvY2l0eSAvIDI1ICsgMC41KSk7XG5cbiAgdmFyIGZpbGxQcmVmZXJlbmNlID0gdmVsb2NpdHkgPiAxID8gJ2FmdGVyJyA6IHZlbG9jaXR5IDwgLTEgPyAnYmVmb3JlJyA6ICdub25lJztcbiAgdmFyIG92ZXJzY2FuQmVnaW4gPSBNYXRoLm1heCgwLCB2aXNpYmxlQmVnaW4gLSAoMSAtIGxlYWRGYWN0b3IpICogb3ZlcnNjYW5MZW5ndGgpO1xuICB2YXIgb3ZlcnNjYW5FbmQgPSBNYXRoLm1heCgwLCB2aXNpYmxlRW5kICsgbGVhZEZhY3RvciAqIG92ZXJzY2FuTGVuZ3RoKTtcbiAgdmFyIGxhc3RJdGVtT2Zmc2V0ID0gZ2V0RnJhbWVNZXRyaWNzQXBwcm94KGl0ZW1Db3VudCAtIDEpLm9mZnNldDtcblxuICBpZiAobGFzdEl0ZW1PZmZzZXQgPCBvdmVyc2NhbkJlZ2luKSB7XG4gICAgLy8gRW50aXJlIGxpc3QgaXMgYmVmb3JlIG91ciBvdmVyc2NhbiB3aW5kb3dcbiAgICByZXR1cm4ge1xuICAgICAgZmlyc3Q6IE1hdGgubWF4KDAsIGl0ZW1Db3VudCAtIDEgLSBtYXhUb1JlbmRlclBlckJhdGNoKSxcbiAgICAgIGxhc3Q6IGl0ZW1Db3VudCAtIDFcbiAgICB9O1xuICB9IC8vIEZpbmQgdGhlIGluZGljZXMgdGhhdCBjb3JyZXNwb25kIHRvIHRoZSBpdGVtcyBhdCB0aGUgcmVuZGVyIGJvdW5kYXJpZXMgd2UncmUgdGFyZ2V0aW5nLlxuXG5cbiAgdmFyIF9lbGVtZW50c1RoYXRPdmVybGFwTyA9IGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzKFtvdmVyc2NhbkJlZ2luLCB2aXNpYmxlQmVnaW4sIHZpc2libGVFbmQsIG92ZXJzY2FuRW5kXSwgcHJvcHMuZ2V0SXRlbUNvdW50KHByb3BzLmRhdGEpLCBnZXRGcmFtZU1ldHJpY3NBcHByb3gpLFxuICAgICAgb3ZlcnNjYW5GaXJzdCA9IF9lbGVtZW50c1RoYXRPdmVybGFwT1swXSxcbiAgICAgIGZpcnN0ID0gX2VsZW1lbnRzVGhhdE92ZXJsYXBPWzFdLFxuICAgICAgbGFzdCA9IF9lbGVtZW50c1RoYXRPdmVybGFwT1syXSxcbiAgICAgIG92ZXJzY2FuTGFzdCA9IF9lbGVtZW50c1RoYXRPdmVybGFwT1szXTtcblxuICBvdmVyc2NhbkZpcnN0ID0gb3ZlcnNjYW5GaXJzdCA9PSBudWxsID8gMCA6IG92ZXJzY2FuRmlyc3Q7XG4gIGZpcnN0ID0gZmlyc3QgPT0gbnVsbCA/IE1hdGgubWF4KDAsIG92ZXJzY2FuRmlyc3QpIDogZmlyc3Q7XG4gIG92ZXJzY2FuTGFzdCA9IG92ZXJzY2FuTGFzdCA9PSBudWxsID8gaXRlbUNvdW50IC0gMSA6IG92ZXJzY2FuTGFzdDtcbiAgbGFzdCA9IGxhc3QgPT0gbnVsbCA/IE1hdGgubWluKG92ZXJzY2FuTGFzdCwgZmlyc3QgKyBtYXhUb1JlbmRlclBlckJhdGNoIC0gMSkgOiBsYXN0O1xuICB2YXIgdmlzaWJsZSA9IHtcbiAgICBmaXJzdDogZmlyc3QsXG4gICAgbGFzdDogbGFzdFxuICB9OyAvLyBXZSB3YW50IHRvIGxpbWl0IHRoZSBudW1iZXIgb2YgbmV3IGNlbGxzIHdlJ3JlIHJlbmRlcmluZyBwZXIgYmF0Y2ggc28gdGhhdCB3ZSBjYW4gZmlsbCB0aGVcbiAgLy8gY29udGVudCBvbiB0aGUgc2NyZWVuIHF1aWNrbHkuIElmIHdlIHJlbmRlcmVkIHRoZSBlbnRpcmUgb3ZlcnNjYW4gd2luZG93IGF0IG9uY2UsIHRoZSB1c2VyXG4gIC8vIGNvdWxkIGJlIHN0YXJpbmcgYXQgd2hpdGUgc3BhY2UgZm9yIGEgbG9uZyB0aW1lIHdhaXRpbmcgZm9yIGEgYnVuY2ggb2Ygb2Zmc2NyZWVuIGNvbnRlbnQgdG9cbiAgLy8gcmVuZGVyLlxuXG4gIHZhciBuZXdDZWxsQ291bnQgPSBuZXdSYW5nZUNvdW50KHByZXYsIHZpc2libGUpO1xuXG4gIHdoaWxlICh0cnVlKSB7XG4gICAgaWYgKGZpcnN0IDw9IG92ZXJzY2FuRmlyc3QgJiYgbGFzdCA+PSBvdmVyc2Nhbkxhc3QpIHtcbiAgICAgIC8vIElmIHdlIGZpbGwgdGhlIGVudGlyZSBvdmVyc2NhbiByYW5nZSwgd2UncmUgZG9uZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHZhciBtYXhOZXdDZWxscyA9IG5ld0NlbGxDb3VudCA+PSBtYXhUb1JlbmRlclBlckJhdGNoO1xuICAgIHZhciBmaXJzdFdpbGxBZGRNb3JlID0gZmlyc3QgPD0gcHJldi5maXJzdCB8fCBmaXJzdCA+IHByZXYubGFzdDtcbiAgICB2YXIgZmlyc3RTaG91bGRJbmNyZW1lbnQgPSBmaXJzdCA+IG92ZXJzY2FuRmlyc3QgJiYgKCFtYXhOZXdDZWxscyB8fCAhZmlyc3RXaWxsQWRkTW9yZSk7XG4gICAgdmFyIGxhc3RXaWxsQWRkTW9yZSA9IGxhc3QgPj0gcHJldi5sYXN0IHx8IGxhc3QgPCBwcmV2LmZpcnN0O1xuICAgIHZhciBsYXN0U2hvdWxkSW5jcmVtZW50ID0gbGFzdCA8IG92ZXJzY2FuTGFzdCAmJiAoIW1heE5ld0NlbGxzIHx8ICFsYXN0V2lsbEFkZE1vcmUpO1xuXG4gICAgaWYgKG1heE5ld0NlbGxzICYmICFmaXJzdFNob3VsZEluY3JlbWVudCAmJiAhbGFzdFNob3VsZEluY3JlbWVudCkge1xuICAgICAgLy8gV2Ugb25seSB3YW50IHRvIHN0b3AgaWYgd2UndmUgaGl0IG1heE5ld0NlbGxzIEFORCB3ZSBjYW5ub3QgaW5jcmVtZW50IGZpcnN0IG9yIGxhc3RcbiAgICAgIC8vIHdpdGhvdXQgcmVuZGVyaW5nIG5ldyBpdGVtcy4gVGhpcyBsZXQncyB1cyBwcmVzZXJ2ZSBhcyBtYW55IGFscmVhZHkgcmVuZGVyZWQgaXRlbXMgYXNcbiAgICAgIC8vIHBvc3NpYmxlLCByZWR1Y2luZyByZW5kZXIgY2h1cm4gYW5kIGtlZXBpbmcgdGhlIHJlbmRlcmVkIG92ZXJzY2FuIHJhbmdlIGFzIGxhcmdlIGFzXG4gICAgICAvLyBwb3NzaWJsZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGlmIChmaXJzdFNob3VsZEluY3JlbWVudCAmJiAhKGZpbGxQcmVmZXJlbmNlID09PSAnYWZ0ZXInICYmIGxhc3RTaG91bGRJbmNyZW1lbnQgJiYgbGFzdFdpbGxBZGRNb3JlKSkge1xuICAgICAgaWYgKGZpcnN0V2lsbEFkZE1vcmUpIHtcbiAgICAgICAgbmV3Q2VsbENvdW50Kys7XG4gICAgICB9XG5cbiAgICAgIGZpcnN0LS07XG4gICAgfVxuXG4gICAgaWYgKGxhc3RTaG91bGRJbmNyZW1lbnQgJiYgIShmaWxsUHJlZmVyZW5jZSA9PT0gJ2JlZm9yZScgJiYgZmlyc3RTaG91bGRJbmNyZW1lbnQgJiYgZmlyc3RXaWxsQWRkTW9yZSkpIHtcbiAgICAgIGlmIChsYXN0V2lsbEFkZE1vcmUpIHtcbiAgICAgICAgbmV3Q2VsbENvdW50Kys7XG4gICAgICB9XG5cbiAgICAgIGxhc3QrKztcbiAgICB9XG4gIH1cblxuICBpZiAoIShsYXN0ID49IGZpcnN0ICYmIGZpcnN0ID49IDAgJiYgbGFzdCA8IGl0ZW1Db3VudCAmJiBmaXJzdCA+PSBvdmVyc2NhbkZpcnN0ICYmIGxhc3QgPD0gb3ZlcnNjYW5MYXN0ICYmIGZpcnN0IDw9IHZpc2libGUuZmlyc3QgJiYgbGFzdCA+PSB2aXNpYmxlLmxhc3QpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgd2luZG93IGNhbGN1bGF0aW9uICcgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBmaXJzdDogZmlyc3QsXG4gICAgICBsYXN0OiBsYXN0LFxuICAgICAgaXRlbUNvdW50OiBpdGVtQ291bnQsXG4gICAgICBvdmVyc2NhbkZpcnN0OiBvdmVyc2NhbkZpcnN0LFxuICAgICAgb3ZlcnNjYW5MYXN0OiBvdmVyc2Nhbkxhc3QsXG4gICAgICB2aXNpYmxlOiB2aXNpYmxlXG4gICAgfSkpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBmaXJzdDogZmlyc3QsXG4gICAgbGFzdDogbGFzdFxuICB9O1xufVxuXG52YXIgVmlydHVhbGl6ZVV0aWxzID0ge1xuICBjb21wdXRlV2luZG93ZWRSZW5kZXJMaW1pdHM6IGNvbXB1dGVXaW5kb3dlZFJlbmRlckxpbWl0cyxcbiAgZWxlbWVudHNUaGF0T3ZlcmxhcE9mZnNldHM6IGVsZW1lbnRzVGhhdE92ZXJsYXBPZmZzZXRzLFxuICBuZXdSYW5nZUNvdW50OiBuZXdSYW5nZUNvdW50XG59O1xudmFyIF9kZWZhdWx0ID0gVmlydHVhbGl6ZVV0aWxzO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7Il0sIm1hcHBpbmdzIjoiQUFTQSxZQUFZOztBQUVaQSxPQUFPLENBQUNDLFVBQVUsR0FBRyxJQUFJO0FBQ3pCRCxPQUFPLENBQUNFLDJCQUEyQixHQUFHQSwyQkFBMkI7QUFDakVGLE9BQU8sQ0FBQ0csMEJBQTBCLEdBQUdBLDBCQUEw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SSxHQUFHRixJQUFJLENBQUNHLEtBQUs7SUFDNUQsSUFBSThCLG1CQUFtQixHQUFHL0IsSUFBSSxHQUFHd0IsWUFBWSxLQUFLLENBQUNHLFdBQVcsSUFBSSxDQUFDRyxlQUFlLENBQUM7SUFFbkYsSUFBSUgsV0FBVyxJQUFJLENBQUNFLG9CQUFvQixJQUFJLENBQUNFLG1CQUFtQixFQUFFO01BS2hFO0lBQ0Y7SUFFQSxJQUFJRixvQkFBb0IsSUFBSSxFQUFFWCxjQUFjLEtBQUssT0FBTyxJQUFJYSxtQkFBbUIsSUFBSUQsZUFBZSxDQUFDLEVBQUU7TUFDbkcsSUFBSUYsZ0JBQWdCLEVBQUU7UUFDcEJGLFlBQVksRUFBRTtNQUNoQjtNQUVBekIsS0FBSyxFQUFFO0lBQ1Q7SUFFQSxJQUFJOEIsbUJBQW1CLElBQUksRUFBRWIsY0FBYyxLQUFLLFFBQVEsSUFBSVcsb0JBQW9CLElBQUlELGdCQUFnQixDQUFDLEVBQUU7TUFDckcsSUFBSUUsZUFBZSxFQUFFO1FBQ25CSixZQUFZLEVBQUU7TUFDaEI7TUFFQTFCLElBQUksRUFBRTtJQUNSO0VBQ0Y7RUFFQSxJQUFJLEVBQUVBLElBQUksSUFBSUMsS0FBSyxJQUFJQSxLQUFLLElBQUksQ0FBQyxJQUFJRCxJQUFJLEdBQUdkLFNBQVMsSUFBSWUsS0FBSyxJQUFJc0IsYUFBYSxJQUFJdkIsSUFBSSxJQUFJd0IsWUFBWSxJQUFJdkIsS0FBSyxJQUFJd0IsT0FBTyxDQUFDeEIsS0FBSyxJQUFJRCxJQUFJLElBQUl5QixPQUFPLENBQUN6QixJQUFJLENBQUMsRUFBRTtJQUMxSixNQUFNLElBQUlnQyxLQUFLLENBQUMseUJBQXlCLEdBQUdwQyxJQUFJLENBQUNDLFNBQVMsQ0FBQztNQUN6REksS0FBSyxFQUFFQSxLQUFLO01BQ1pELElBQUksRUFBRUEsSUFBSTtNQUNWZCxTQUFTLEVBQUVBLFNBQVM7TUFDcEJxQyxhQUFhLEVBQUVBLGFBQWE7TUFDNUJDLFlBQVksRUFBRUEsWUFBWTtNQUMxQkMsT0FBTyxFQUFFQTtJQUNYLENBQUMsQ0FBQyxDQUFDO0VBQ0w7RUFFQSxPQUFPO0lBQ0x4QixLQUFLLEVBQUVBLEtBQUs7SUFDWkQsSUFBSSxFQUFFQTtFQUNSLENBQUM7QUFDSDtBQUVBLElBQUlpQyxlQUFlLEdBQUc7RUFDcEJ4RCwyQkFBMkIsRUFBRUEsMkJBQTJCO0VBQ3hEQywwQkFBMEIsRUFBRUEsMEJBQTBCO0VBQ3REQyxhQUFhLEVBQUVBO0FBQ2pCLENBQUM7QUFDRCxJQUFJdUQsUUFBUSxHQUFHRCxlQUFlO0FBQzlCMUQsT0FBTyxDQUFDSyxPQUFPLEdBQUdzRCxRQUFRIiwiaWdub3JlTGlzdCI6W119