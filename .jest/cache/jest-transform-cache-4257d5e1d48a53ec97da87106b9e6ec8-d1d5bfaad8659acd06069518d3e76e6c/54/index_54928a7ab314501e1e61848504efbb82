f59125a80e42c80060cc7ad00e913145
"use strict";

exports.__esModule = true;
exports.default = useElementLayout;
var _ExecutionEnvironment = require("fbjs/lib/ExecutionEnvironment");
var _useLayoutEffect = _interopRequireDefault(require("../useLayoutEffect"));
var _UIManager = _interopRequireDefault(require("../../exports/UIManager"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
var DOM_LAYOUT_HANDLER_NAME = '__reactLayoutHandler';
var didWarn = !_ExecutionEnvironment.canUseDOM;
var resizeObserver = null;
function getResizeObserver() {
  if (_ExecutionEnvironment.canUseDOM && typeof window.ResizeObserver !== 'undefined') {
    if (resizeObserver == null) {
      resizeObserver = new window.ResizeObserver(function (entries) {
        entries.forEach(function (entry) {
          var node = entry.target;
          var onLayout = node[DOM_LAYOUT_HANDLER_NAME];
          if (typeof onLayout === 'function') {
            _UIManager.default.measure(node, function (x, y, width, height, left, top) {
              var event = {
                nativeEvent: {
                  layout: {
                    x: x,
                    y: y,
                    width: width,
                    height: height,
                    left: left,
                    top: top
                  }
                },
                timeStamp: Date.now()
              };
              Object.defineProperty(event.nativeEvent, 'target', {
                enumerable: true,
                get: function get() {
                  return entry.target;
                }
              });
              onLayout(event);
            });
          }
        });
      });
    }
  } else if (!didWarn) {
    if (process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test') {
      console.warn('onLayout relies on ResizeObserver which is not supported by your browser. ' + 'Please include a polyfill, e.g., https://github.com/que-etc/resize-observer-polyfill.');
      didWarn = true;
    }
  }
  return resizeObserver;
}
function useElementLayout(ref, onLayout) {
  var observer = getResizeObserver();
  (0, _useLayoutEffect.default)(function () {
    var node = ref.current;
    if (node != null) {
      node[DOM_LAYOUT_HANDLER_NAME] = onLayout;
    }
  }, [ref, onLayout]);
  (0, _useLayoutEffect.default)(function () {
    var node = ref.current;
    if (node != null && observer != null) {
      if (typeof node[DOM_LAYOUT_HANDLER_NAME] === 'function') {
        observer.observe(node);
      } else {
        observer.unobserve(node);
      }
    }
    return function () {
      if (node != null && observer != null) {
        observer.unobserve(node);
      }
    };
  }, [ref, observer]);
}
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJ1c2VFbGVtZW50TGF5b3V0IiwiX0V4ZWN1dGlvbkVudmlyb25tZW50IiwicmVxdWlyZSIsIl91c2VMYXlvdXRFZmZlY3QiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX1VJTWFuYWdlciIsIm9iaiIsIkRPTV9MQVlPVVRfSEFORExFUl9OQU1FIiwiZGlkV2FybiIsImNhblVzZURPTSIsInJlc2l6ZU9ic2VydmVyIiwiZ2V0UmVzaXplT2JzZXJ2ZXIiLCJ3aW5kb3ciLCJSZXNpemVPYnNlcnZlciIsImVudHJpZXMiLCJmb3JFYWNoIiwiZW50cnkiLCJub2RlIiwidGFyZ2V0Iiwib25MYXlvdXQiLCJtZWFzdXJlIiwieCIsInkiLCJ3aWR0aCIsImhlaWdodCIsImxlZnQiLCJ0b3AiLCJldmVudCIsIm5hdGl2ZUV2ZW50IiwibGF5b3V0IiwidGltZVN0YW1wIiwiRGF0ZSIsIm5vdyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImNvbnNvbGUiLCJ3YXJuIiwicmVmIiwib2JzZXJ2ZXIiLCJjdXJyZW50Iiwib2JzZXJ2ZSIsInVub2JzZXJ2ZSIsIm1vZHVsZSJdLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdXNlRWxlbWVudExheW91dDtcblxudmFyIF9FeGVjdXRpb25FbnZpcm9ubWVudCA9IHJlcXVpcmUoXCJmYmpzL2xpYi9FeGVjdXRpb25FbnZpcm9ubWVudFwiKTtcblxudmFyIF91c2VMYXlvdXRFZmZlY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi91c2VMYXlvdXRFZmZlY3RcIikpO1xuXG52YXIgX1VJTWFuYWdlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uLy4uL2V4cG9ydHMvVUlNYW5hZ2VyXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE5pY29sYXMgR2FsbGFnaGVyLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG52YXIgRE9NX0xBWU9VVF9IQU5ETEVSX05BTUUgPSAnX19yZWFjdExheW91dEhhbmRsZXInO1xudmFyIGRpZFdhcm4gPSAhX0V4ZWN1dGlvbkVudmlyb25tZW50LmNhblVzZURPTTtcbnZhciByZXNpemVPYnNlcnZlciA9IG51bGw7XG5cbmZ1bmN0aW9uIGdldFJlc2l6ZU9ic2VydmVyKCkge1xuICBpZiAoX0V4ZWN1dGlvbkVudmlyb25tZW50LmNhblVzZURPTSAmJiB0eXBlb2Ygd2luZG93LlJlc2l6ZU9ic2VydmVyICE9PSAndW5kZWZpbmVkJykge1xuICAgIGlmIChyZXNpemVPYnNlcnZlciA9PSBudWxsKSB7XG4gICAgICByZXNpemVPYnNlcnZlciA9IG5ldyB3aW5kb3cuUmVzaXplT2JzZXJ2ZXIoZnVuY3Rpb24gKGVudHJpZXMpIHtcbiAgICAgICAgZW50cmllcy5mb3JFYWNoKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgIHZhciBub2RlID0gZW50cnkudGFyZ2V0O1xuICAgICAgICAgIHZhciBvbkxheW91dCA9IG5vZGVbRE9NX0xBWU9VVF9IQU5ETEVSX05BTUVdO1xuXG4gICAgICAgICAgaWYgKHR5cGVvZiBvbkxheW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgLy8gV2Ugc3RpbGwgbmVlZCB0byBtZWFzdXJlIHRoZSB2aWV3IGJlY2F1c2UgYnJvd3NlcnMgZG9uJ3QgeWV0IHByb3ZpZGVcbiAgICAgICAgICAgIC8vIGJvcmRlci1ib3ggZGltZW5zaW9ucyBpbiB0aGUgZW50cnlcbiAgICAgICAgICAgIF9VSU1hbmFnZXIuZGVmYXVsdC5tZWFzdXJlKG5vZGUsIGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBsZWZ0LCB0b3ApIHtcbiAgICAgICAgICAgICAgdmFyIGV2ZW50ID0ge1xuICAgICAgICAgICAgICAgIC8vICRGbG93Rml4TWVcbiAgICAgICAgICAgICAgICBuYXRpdmVFdmVudDoge1xuICAgICAgICAgICAgICAgICAgbGF5b3V0OiB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHgsXG4gICAgICAgICAgICAgICAgICAgIHk6IHksXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogdG9wXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aW1lU3RhbXA6IERhdGUubm93KClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV2ZW50Lm5hdGl2ZUV2ZW50LCAndGFyZ2V0Jywge1xuICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZW50cnkudGFyZ2V0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIG9uTGF5b3V0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoIWRpZFdhcm4pIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ29uTGF5b3V0IHJlbGllcyBvbiBSZXNpemVPYnNlcnZlciB3aGljaCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3Nlci4gJyArICdQbGVhc2UgaW5jbHVkZSBhIHBvbHlmaWxsLCBlLmcuLCBodHRwczovL2dpdGh1Yi5jb20vcXVlLWV0Yy9yZXNpemUtb2JzZXJ2ZXItcG9seWZpbGwuJyk7XG4gICAgICBkaWRXYXJuID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzaXplT2JzZXJ2ZXI7XG59XG5cbmZ1bmN0aW9uIHVzZUVsZW1lbnRMYXlvdXQocmVmLCBvbkxheW91dCkge1xuICB2YXIgb2JzZXJ2ZXIgPSBnZXRSZXNpemVPYnNlcnZlcigpO1xuICAoMCwgX3VzZUxheW91dEVmZmVjdC5kZWZhdWx0KShmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vZGUgPSByZWYuY3VycmVudDtcblxuICAgIGlmIChub2RlICE9IG51bGwpIHtcbiAgICAgIG5vZGVbRE9NX0xBWU9VVF9IQU5ETEVSX05BTUVdID0gb25MYXlvdXQ7XG4gICAgfVxuICB9LCBbcmVmLCBvbkxheW91dF0pOyAvLyBPYnNlcnZpbmcgaXMgZG9uZSBpbiBhIHNlcGFyYXRlIGVmZmVjdCB0byBhdm9pZCB0aGlzIGVmZmVjdCBydW5uaW5nXG4gIC8vIHdoZW4gJ29uTGF5b3V0JyBjaGFuZ2VzLlxuXG4gICgwLCBfdXNlTGF5b3V0RWZmZWN0LmRlZmF1bHQpKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm9kZSA9IHJlZi5jdXJyZW50O1xuXG4gICAgaWYgKG5vZGUgIT0gbnVsbCAmJiBvYnNlcnZlciAhPSBudWxsKSB7XG4gICAgICBpZiAodHlwZW9mIG5vZGVbRE9NX0xBWU9VVF9IQU5ETEVSX05BTUVdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUobm9kZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYnNlcnZlci51bm9ic2VydmUobm9kZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChub2RlICE9IG51bGwgJiYgb2JzZXJ2ZXIgIT0gbnVsbCkge1xuICAgICAgICBvYnNlcnZlci51bm9ic2VydmUobm9kZSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW3JlZiwgb2JzZXJ2ZXJdKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzLmRlZmF1bHQ7Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaQSxPQUFPLENBQUNDLFVBQVUsR0FBRyxJQUFJO0FBQ3pCRCxPQUFPLENBQUNFLE9BQU8sR0FBR0MsZ0JBQWdCO0FBRWxDLElBQUlDLHFCQUFxQixHQUFHQyxPQUFPLENBQUMsK0JBQStCLENBQUM7QUFFcEUsSUFBSUMsZ0JBQWdCLEdBQUdDLHNCQUFzQixDQUFDRixPQUFPLHFCQUFxQixDQUFDLENBQUM7QUFFNUUsSUFBSUcsVUFBVSxHQUFHRCxzQkFBc0IsQ0FBQ0YsT0FBTywwQkFBMEIsQ0FBQyxDQUFDO0FBRTNFLFNBQVNFLHNCQUFzQkEsQ0FBQ0UsR0FBRyxFQUFFO0VBQUUsT0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNSLFVBQVUsR0FBR1EsR0FBRyxHQUFHO0lBQUVQLE9BQU8sRUFBRU87RUFBSSxDQUFDO0FBQUU7QUFVOUYsSUFBSUMsdUJBQXVCLEdBQUcsc0JBQXNCO0FBQ3BELElBQUlDLE9BQU8sR0FBRyxDQUFDUCxxQkFBcUIsQ0FBQ1EsU0FBUztBQUM5QyxJQUFJQyxjQUFjLEdBQUcsSUFBSTtBQUV6QixTQUFTQyxpQkFBaUJBLENBQUEsRUFBRztFQUMzQixJQUFJVixxQkFBcUIsQ0FBQ1EsU0FBUyxJQUFJLE9BQU9HLE1BQU0sQ0FBQ0MsY0FBYyxLQUFLLFdBQVcsRUFBRTtJQUNuRixJQUFJSCxjQUFjLElBQUksSUFBSSxFQUFFO01BQzFCQSxjQUFjLEdBQUcsSUFBSUUsTUFBTSxDQUFDQyxjQUFjLENBQUMsVUFBVUMsT0FBTyxFQUFFO1FBQzVEQSxPQUFPLENBQUNDLE9BQU8sQ0FBQyxVQUFVQyxLQUFLLEVBQUU7VUFDL0IsSUFBSUMsSUFBSSxHQUFHRCxLQUFLLENBQUNFLE1BQU07VUFDdkIsSUFBSUMsUUFBUSxHQUFHRixJQUFJLENBQUNWLHVCQUF1QixDQUFDO1VBRTVDLElBQUksT0FBT1ksUUFBUSxLQUFLLFVBQVUsRUFBRTtZQUdsQ2QsVUFBVSxDQUFDTixPQUFPLENBQUNxQixPQUFPLENBQUNILElBQUksRUFBRSxVQUFVSSxDQUFDLEVBQUVDLENBQUMsRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEVBQUVDLElBQUksRUFBRUMsR0FBRyxFQUFFO2NBQ3pFLElBQUlDLEtBQUssR0FBRztnQkFFVkMsV0FBVyxFQUFFO2tCQUNYQyxNQUFNLEVBQUU7b0JBQ05SLENBQUMsRUFBRUEsQ0FBQztvQkFDSkMsQ0FBQyxFQUFFQSxDQUFDO29CQUNKQyxLQUFLLEVBQUVBLEtBQUs7b0JBQ1pDLE1BQU0sRUFBRUEsTUFBTTtvQkFDZEMsSUFBSSxFQUFFQSxJQUFJO29CQUNWQyxHQUFHLEVBQUVBO2tCQUNQO2dCQUNGLENBQUM7Z0JBQ0RJLFNBQVMsRUFBRUMsSUFBSSxDQUFDQyxHQUFHLENBQUM7Y0FDdEIsQ0FBQztjQUNEQyxNQUFNLENBQUNDLGNBQWMsQ0FBQ1AsS0FBSyxDQUFDQyxXQUFXLEVBQUUsUUFBUSxFQUFFO2dCQUNqRE8sVUFBVSxFQUFFLElBQUk7Z0JBQ2hCQyxHQUFHLEVBQUUsU0FBU0EsR0FBR0EsQ0FBQSxFQUFHO2tCQUNsQixPQUFPcEIsS0FBSyxDQUFDRSxNQUFNO2dCQUNyQjtjQUNGLENBQUMsQ0FBQztjQUNGQyxRQUFRLENBQUNRLEtBQUssQ0FBQztZQUNqQixDQUFDLENBQUM7VUFDSjtRQUNGLENBQUMsQ0FBQztNQUNKLENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQyxNQUFNLElBQUksQ0FBQ25CLE9BQU8sRUFBRTtJQUNuQixJQUFJNkIsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxZQUFZLElBQUlGLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEtBQUssTUFBTSxFQUFFO01BQzVFQyxPQUFPLENBQUNDLElBQUksQ0FBQyw0RUFBNEUsR0FBRyx1RkFBdUYsQ0FBQztNQUNwTGpDLE9BQU8sR0FBRyxJQUFJO0lBQ2hCO0VBQ0Y7RUFFQSxPQUFPRSxjQUFjO0FBQ3ZCO0FBRUEsU0FBU1YsZ0JBQWdCQSxDQUFDMEMsR0FBRyxFQUFFdkIsUUFBUSxFQUFFO0VBQ3ZDLElBQUl3QixRQUFRLEdBQUdoQyxpQkFBaUIsQ0FBQyxDQUFDO0VBQ2xDLENBQUMsQ0FBQyxFQUFFUixnQkFBZ0IsQ0FBQ0osT0FBTyxFQUFFLFlBQVk7SUFDeEMsSUFBSWtCLElBQUksR0FBR3lCLEdBQUcsQ0FBQ0UsT0FBTztJQUV0QixJQUFJM0IsSUFBSSxJQUFJLElBQUksRUFBRTtNQUNoQkEsSUFBSSxDQUFDVix1QkFBdUIsQ0FBQyxHQUFHWSxRQUFRO0lBQzFDO0VBQ0YsQ0FBQyxFQUFFLENBQUN1QixHQUFHLEVBQUV2QixRQUFRLENBQUMsQ0FBQztFQUduQixDQUFDLENBQUMsRUFBRWhCLGdCQUFnQixDQUFDSixPQUFPLEVBQUUsWUFBWTtJQUN4QyxJQUFJa0IsSUFBSSxHQUFHeUIsR0FBRyxDQUFDRSxPQUFPO0lBRXRCLElBQUkzQixJQUFJLElBQUksSUFBSSxJQUFJMEIsUUFBUSxJQUFJLElBQUksRUFBRTtNQUNwQyxJQUFJLE9BQU8xQixJQUFJLENBQUNWLHVCQUF1QixDQUFDLEtBQUssVUFBVSxFQUFFO1FBQ3ZEb0MsUUFBUSxDQUFDRSxPQUFPLENBQUM1QixJQUFJLENBQUM7TUFDeEIsQ0FBQyxNQUFNO1FBQ0wwQixRQUFRLENBQUNHLFNBQVMsQ0FBQzdCLElBQUksQ0FBQztNQUMxQjtJQUNGO0lBRUEsT0FBTyxZQUFZO01BQ2pCLElBQUlBLElBQUksSUFBSSxJQUFJLElBQUkwQixRQUFRLElBQUksSUFBSSxFQUFFO1FBQ3BDQSxRQUFRLENBQUNHLFNBQVMsQ0FBQzdCLElBQUksQ0FBQztNQUMxQjtJQUNGLENBQUM7RUFDSCxDQUFDLEVBQUUsQ0FBQ3lCLEdBQUcsRUFBRUMsUUFBUSxDQUFDLENBQUM7QUFDckI7QUFFQUksTUFBTSxDQUFDbEQsT0FBTyxHQUFHQSxPQUFPLENBQUNFLE9BQU8iLCJpZ25vcmVMaXN0IjpbXX0=