76e95a60c9c0b58d57354fc15ac10ec7
'use strict';

exports.__esModule = true;
exports.default = void 0;
var _AnimatedNode = _interopRequireDefault(require("./AnimatedNode"));
var _AnimatedTransform = _interopRequireDefault(require("./AnimatedTransform"));
var _AnimatedWithChildren2 = _interopRequireDefault(require("./AnimatedWithChildren"));
var _NativeAnimatedHelper = _interopRequireDefault(require("../NativeAnimatedHelper"));
var _flattenStyle = _interopRequireDefault(require("../../../../exports/StyleSheet/flattenStyle"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);
  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }
  return keys;
}
function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }
  return target;
}
function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
function _inheritsLoose(subClass, superClass) {
  subClass.prototype = Object.create(superClass.prototype);
  subClass.prototype.constructor = subClass;
  _setPrototypeOf(subClass, superClass);
}
function _setPrototypeOf(o, p) {
  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {
    o.__proto__ = p;
    return o;
  };
  return _setPrototypeOf(o, p);
}
var AnimatedStyle = function (_AnimatedWithChildren) {
  _inheritsLoose(AnimatedStyle, _AnimatedWithChildren);
  function AnimatedStyle(style) {
    var _this;
    _this = _AnimatedWithChildren.call(this) || this;
    style = (0, _flattenStyle.default)(style) || {};
    if (style.transform) {
      style = _objectSpread(_objectSpread({}, style), {}, {
        transform: new _AnimatedTransform.default(style.transform)
      });
    }
    _this._style = style;
    return _this;
  }
  var _proto = AnimatedStyle.prototype;
  _proto._walkStyleAndGetValues = function _walkStyleAndGetValues(style) {
    var updatedStyle = {};
    for (var key in style) {
      var value = style[key];
      if (value instanceof _AnimatedNode.default) {
        if (!value.__isNative) {
          updatedStyle[key] = value.__getValue();
        }
      } else if (value && !Array.isArray(value) && typeof value === 'object') {
        updatedStyle[key] = this._walkStyleAndGetValues(value);
      } else {
        updatedStyle[key] = value;
      }
    }
    return updatedStyle;
  };
  _proto.__getValue = function __getValue() {
    return this._walkStyleAndGetValues(this._style);
  };
  _proto._walkStyleAndGetAnimatedValues = function _walkStyleAndGetAnimatedValues(style) {
    var updatedStyle = {};
    for (var key in style) {
      var value = style[key];
      if (value instanceof _AnimatedNode.default) {
        updatedStyle[key] = value.__getAnimatedValue();
      } else if (value && !Array.isArray(value) && typeof value === 'object') {
        updatedStyle[key] = this._walkStyleAndGetAnimatedValues(value);
      }
    }
    return updatedStyle;
  };
  _proto.__getAnimatedValue = function __getAnimatedValue() {
    return this._walkStyleAndGetAnimatedValues(this._style);
  };
  _proto.__attach = function __attach() {
    for (var key in this._style) {
      var value = this._style[key];
      if (value instanceof _AnimatedNode.default) {
        value.__addChild(this);
      }
    }
  };
  _proto.__detach = function __detach() {
    for (var key in this._style) {
      var value = this._style[key];
      if (value instanceof _AnimatedNode.default) {
        value.__removeChild(this);
      }
    }
    _AnimatedWithChildren.prototype.__detach.call(this);
  };
  _proto.__makeNative = function __makeNative() {
    for (var key in this._style) {
      var value = this._style[key];
      if (value instanceof _AnimatedNode.default) {
        value.__makeNative();
      }
    }
    _AnimatedWithChildren.prototype.__makeNative.call(this);
  };
  _proto.__getNativeConfig = function __getNativeConfig() {
    var styleConfig = {};
    for (var styleKey in this._style) {
      if (this._style[styleKey] instanceof _AnimatedNode.default) {
        var style = this._style[styleKey];
        style.__makeNative();
        styleConfig[styleKey] = style.__getNativeTag();
      }
    }
    _NativeAnimatedHelper.default.validateStyles(styleConfig);
    return {
      type: 'style',
      style: styleConfig
    };
  };
  return AnimatedStyle;
}(_AnimatedWithChildren2.default);
var _default = AnimatedStyle;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfQW5pbWF0ZWROb2RlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfQW5pbWF0ZWRUcmFuc2Zvcm0iLCJfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4yIiwiX05hdGl2ZUFuaW1hdGVkSGVscGVyIiwiX2ZsYXR0ZW5TdHlsZSIsIm9iaiIsIm93bktleXMiLCJvYmplY3QiLCJlbnVtZXJhYmxlT25seSIsImtleXMiLCJPYmplY3QiLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJzeW1ib2xzIiwiZmlsdGVyIiwic3ltIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsInB1c2giLCJhcHBseSIsIl9vYmplY3RTcHJlYWQiLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwiZm9yRWFjaCIsImtleSIsIl9kZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiX2luaGVyaXRzTG9vc2UiLCJzdWJDbGFzcyIsInN1cGVyQ2xhc3MiLCJwcm90b3R5cGUiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsIl9zZXRQcm90b3R5cGVPZiIsIm8iLCJwIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBbmltYXRlZFN0eWxlIiwiX0FuaW1hdGVkV2l0aENoaWxkcmVuIiwic3R5bGUiLCJfdGhpcyIsImNhbGwiLCJ0cmFuc2Zvcm0iLCJfc3R5bGUiLCJfcHJvdG8iLCJfd2Fsa1N0eWxlQW5kR2V0VmFsdWVzIiwidXBkYXRlZFN0eWxlIiwiX19pc05hdGl2ZSIsIl9fZ2V0VmFsdWUiLCJBcnJheSIsImlzQXJyYXkiLCJfd2Fsa1N0eWxlQW5kR2V0QW5pbWF0ZWRWYWx1ZXMiLCJfX2dldEFuaW1hdGVkVmFsdWUiLCJfX2F0dGFjaCIsIl9fYWRkQ2hpbGQiLCJfX2RldGFjaCIsIl9fcmVtb3ZlQ2hpbGQiLCJfX21ha2VOYXRpdmUiLCJfX2dldE5hdGl2ZUNvbmZpZyIsInN0eWxlQ29uZmlnIiwic3R5bGVLZXkiLCJfX2dldE5hdGl2ZVRhZyIsInZhbGlkYXRlU3R5bGVzIiwidHlwZSIsIl9kZWZhdWx0IiwibW9kdWxlIl0sInNvdXJjZXMiOlsiQW5pbWF0ZWRTdHlsZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7XG5cbnZhciBfQW5pbWF0ZWROb2RlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZE5vZGVcIikpO1xuXG52YXIgX0FuaW1hdGVkVHJhbnNmb3JtID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZFRyYW5zZm9ybVwiKSk7XG5cbnZhciBfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9BbmltYXRlZFdpdGhDaGlsZHJlblwiKSk7XG5cbnZhciBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9OYXRpdmVBbmltYXRlZEhlbHBlclwiKSk7XG5cbnZhciBfZmxhdHRlblN0eWxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vLi4vLi4vLi4vZXhwb3J0cy9TdHlsZVNoZWV0L2ZsYXR0ZW5TdHlsZVwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHNMb29zZShzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MucHJvdG90eXBlKTsgc3ViQ2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc3ViQ2xhc3M7IF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH1cblxuZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH1cblxudmFyIEFuaW1hdGVkU3R5bGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9BbmltYXRlZFdpdGhDaGlsZHJlbikge1xuICBfaW5oZXJpdHNMb29zZShBbmltYXRlZFN0eWxlLCBfQW5pbWF0ZWRXaXRoQ2hpbGRyZW4pO1xuXG4gIGZ1bmN0aW9uIEFuaW1hdGVkU3R5bGUoc3R5bGUpIHtcbiAgICB2YXIgX3RoaXM7XG5cbiAgICBfdGhpcyA9IF9BbmltYXRlZFdpdGhDaGlsZHJlbi5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgc3R5bGUgPSAoMCwgX2ZsYXR0ZW5TdHlsZS5kZWZhdWx0KShzdHlsZSkgfHwge307XG5cbiAgICBpZiAoc3R5bGUudHJhbnNmb3JtKSB7XG4gICAgICBzdHlsZSA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3R5bGUpLCB7fSwge1xuICAgICAgICB0cmFuc2Zvcm06IG5ldyBfQW5pbWF0ZWRUcmFuc2Zvcm0uZGVmYXVsdChzdHlsZS50cmFuc2Zvcm0pXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBfdGhpcy5fc3R5bGUgPSBzdHlsZTtcbiAgICByZXR1cm4gX3RoaXM7XG4gIH0gLy8gUmVjdXJzaXZlbHkgZ2V0IHZhbHVlcyBmb3IgbmVzdGVkIHN0eWxlcyAobGlrZSBpT1MncyBzaGFkb3dPZmZzZXQpXG5cblxuICB2YXIgX3Byb3RvID0gQW5pbWF0ZWRTdHlsZS5wcm90b3R5cGU7XG5cbiAgX3Byb3RvLl93YWxrU3R5bGVBbmRHZXRWYWx1ZXMgPSBmdW5jdGlvbiBfd2Fsa1N0eWxlQW5kR2V0VmFsdWVzKHN0eWxlKSB7XG4gICAgdmFyIHVwZGF0ZWRTdHlsZSA9IHt9O1xuXG4gICAgZm9yICh2YXIga2V5IGluIHN0eWxlKSB7XG4gICAgICB2YXIgdmFsdWUgPSBzdHlsZVtrZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlLmRlZmF1bHQpIHtcbiAgICAgICAgaWYgKCF2YWx1ZS5fX2lzTmF0aXZlKSB7XG4gICAgICAgICAgLy8gV2UgY2Fubm90IHVzZSB2YWx1ZSBvZiBuYXRpdmVseSBkcml2ZW4gbm9kZXMgdGhpcyB3YXkgYXMgdGhlIHZhbHVlIHdlIGhhdmUgYWNjZXNzIGZyb21cbiAgICAgICAgICAvLyBKUyBtYXkgbm90IGJlIHVwIHRvIGRhdGUuXG4gICAgICAgICAgdXBkYXRlZFN0eWxlW2tleV0gPSB2YWx1ZS5fX2dldFZhbHVlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gU3VwcG9ydCBhbmltYXRpbmcgbmVzdGVkIHZhbHVlcyAoZm9yIGV4YW1wbGU6IHNoYWRvd09mZnNldC5oZWlnaHQpXG4gICAgICAgIHVwZGF0ZWRTdHlsZVtrZXldID0gdGhpcy5fd2Fsa1N0eWxlQW5kR2V0VmFsdWVzKHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZWRTdHlsZVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVwZGF0ZWRTdHlsZTtcbiAgfTtcblxuICBfcHJvdG8uX19nZXRWYWx1ZSA9IGZ1bmN0aW9uIF9fZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dhbGtTdHlsZUFuZEdldFZhbHVlcyh0aGlzLl9zdHlsZSk7XG4gIH0gLy8gUmVjdXJzaXZlbHkgZ2V0IGFuaW1hdGVkIHZhbHVlcyBmb3IgbmVzdGVkIHN0eWxlcyAobGlrZSBpT1MncyBzaGFkb3dPZmZzZXQpXG4gIDtcblxuICBfcHJvdG8uX3dhbGtTdHlsZUFuZEdldEFuaW1hdGVkVmFsdWVzID0gZnVuY3Rpb24gX3dhbGtTdHlsZUFuZEdldEFuaW1hdGVkVmFsdWVzKHN0eWxlKSB7XG4gICAgdmFyIHVwZGF0ZWRTdHlsZSA9IHt9O1xuXG4gICAgZm9yICh2YXIga2V5IGluIHN0eWxlKSB7XG4gICAgICB2YXIgdmFsdWUgPSBzdHlsZVtrZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlLmRlZmF1bHQpIHtcbiAgICAgICAgdXBkYXRlZFN0eWxlW2tleV0gPSB2YWx1ZS5fX2dldEFuaW1hdGVkVmFsdWUoKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gU3VwcG9ydCBhbmltYXRpbmcgbmVzdGVkIHZhbHVlcyAoZm9yIGV4YW1wbGU6IHNoYWRvd09mZnNldC5oZWlnaHQpXG4gICAgICAgIHVwZGF0ZWRTdHlsZVtrZXldID0gdGhpcy5fd2Fsa1N0eWxlQW5kR2V0QW5pbWF0ZWRWYWx1ZXModmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1cGRhdGVkU3R5bGU7XG4gIH07XG5cbiAgX3Byb3RvLl9fZ2V0QW5pbWF0ZWRWYWx1ZSA9IGZ1bmN0aW9uIF9fZ2V0QW5pbWF0ZWRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fd2Fsa1N0eWxlQW5kR2V0QW5pbWF0ZWRWYWx1ZXModGhpcy5fc3R5bGUpO1xuICB9O1xuXG4gIF9wcm90by5fX2F0dGFjaCA9IGZ1bmN0aW9uIF9fYXR0YWNoKCkge1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9zdHlsZSkge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5fc3R5bGVba2V5XTtcblxuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX0FuaW1hdGVkTm9kZS5kZWZhdWx0KSB7XG4gICAgICAgIHZhbHVlLl9fYWRkQ2hpbGQodGhpcyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIF9wcm90by5fX2RldGFjaCA9IGZ1bmN0aW9uIF9fZGV0YWNoKCkge1xuICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9zdHlsZSkge1xuICAgICAgdmFyIHZhbHVlID0gdGhpcy5fc3R5bGVba2V5XTtcblxuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX0FuaW1hdGVkTm9kZS5kZWZhdWx0KSB7XG4gICAgICAgIHZhbHVlLl9fcmVtb3ZlQ2hpbGQodGhpcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgX0FuaW1hdGVkV2l0aENoaWxkcmVuLnByb3RvdHlwZS5fX2RldGFjaC5jYWxsKHRoaXMpO1xuICB9O1xuXG4gIF9wcm90by5fX21ha2VOYXRpdmUgPSBmdW5jdGlvbiBfX21ha2VOYXRpdmUoKSB7XG4gICAgZm9yICh2YXIga2V5IGluIHRoaXMuX3N0eWxlKSB7XG4gICAgICB2YXIgdmFsdWUgPSB0aGlzLl9zdHlsZVtrZXldO1xuXG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfQW5pbWF0ZWROb2RlLmRlZmF1bHQpIHtcbiAgICAgICAgdmFsdWUuX19tYWtlTmF0aXZlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgX0FuaW1hdGVkV2l0aENoaWxkcmVuLnByb3RvdHlwZS5fX21ha2VOYXRpdmUuY2FsbCh0aGlzKTtcbiAgfTtcblxuICBfcHJvdG8uX19nZXROYXRpdmVDb25maWcgPSBmdW5jdGlvbiBfX2dldE5hdGl2ZUNvbmZpZygpIHtcbiAgICB2YXIgc3R5bGVDb25maWcgPSB7fTtcblxuICAgIGZvciAodmFyIHN0eWxlS2V5IGluIHRoaXMuX3N0eWxlKSB7XG4gICAgICBpZiAodGhpcy5fc3R5bGVbc3R5bGVLZXldIGluc3RhbmNlb2YgX0FuaW1hdGVkTm9kZS5kZWZhdWx0KSB7XG4gICAgICAgIHZhciBzdHlsZSA9IHRoaXMuX3N0eWxlW3N0eWxlS2V5XTtcblxuICAgICAgICBzdHlsZS5fX21ha2VOYXRpdmUoKTtcblxuICAgICAgICBzdHlsZUNvbmZpZ1tzdHlsZUtleV0gPSBzdHlsZS5fX2dldE5hdGl2ZVRhZygpO1xuICAgICAgfSAvLyBOb24tYW5pbWF0ZWQgc3R5bGVzIGFyZSBzZXQgdXNpbmcgYHNldE5hdGl2ZVByb3BzYCwgbm8gbmVlZFxuICAgICAgLy8gdG8gcGFzcyB0aG9zZSBhcyBhIHBhcnQgb2YgdGhlIG5vZGUgY29uZmlnXG5cbiAgICB9XG5cbiAgICBfTmF0aXZlQW5pbWF0ZWRIZWxwZXIuZGVmYXVsdC52YWxpZGF0ZVN0eWxlcyhzdHlsZUNvbmZpZyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3N0eWxlJyxcbiAgICAgIHN0eWxlOiBzdHlsZUNvbmZpZ1xuICAgIH07XG4gIH07XG5cbiAgcmV0dXJuIEFuaW1hdGVkU3R5bGU7XG59KF9BbmltYXRlZFdpdGhDaGlsZHJlbjIuZGVmYXVsdCk7XG5cbnZhciBfZGVmYXVsdCA9IEFuaW1hdGVkU3R5bGU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdLCJtYXBwaW5ncyI6IkFBU0EsWUFBWTs7QUFFWkEsT0FBTyxDQUFDQyxVQUFVLEdBQUcsSUFBSTtBQUN6QkQsT0FBTyxDQUFDRSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBRXhCLElBQUlDLGFBQWEsR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8saUJBQWlCLENBQUMsQ0FBQztBQUVyRSxJQUFJQyxrQkFBa0IsR0FBR0Ysc0JBQXNCLENBQUNDLE9BQU8sc0JBQXNCLENBQUMsQ0FBQztBQUUvRSxJQUFJRSxzQkFBc0IsR0FBR0gsc0JBQXNCLENBQUNDLE9BQU8seUJBQXlCLENBQUMsQ0FBQztBQUV0RixJQUFJRyxxQkFBcUIsR0FBR0osc0JBQXNCLENBQUNDLE9BQU8sMEJBQTBCLENBQUMsQ0FBQztBQUV0RixJQUFJSSxhQUFhLEdBQUdMLHNCQUFzQixDQUFDQyxPQUFPLDhDQUE4QyxDQUFDLENBQUM7QUFFbEcsU0FBU0Qsc0JBQXNCQSxDQUFDTSxHQUFHLEVBQUU7RUFBRSxPQUFPQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ1QsVUFBVSxHQUFHUyxHQUFHLEdBQUc7SUFBRVIsT0FBTyxFQUFFUTtFQUFJLENBQUM7QUFBRTtBQUU5RixTQUFTQyxPQUFPQSxDQUFDQyxNQUFNLEVBQUVDLGNBQWMsRUFBRTtFQUFFLElBQUlDLElBQUksR0FBR0MsTUFBTSxDQUFDRCxJQUFJLENBQUNGLE1BQU0sQ0FBQztFQUFFLElBQUlHLE1BQU0sQ0FBQ0MscUJBQXFCLEVBQUU7SUFBRSxJQUFJQyxPQUFPLEdBQUdGLE1BQU0sQ0FBQ0MscUJBQXFCLENBQUNKLE1BQU0sQ0FBQztJQUFFLElBQUlDLGNBQWMsRUFBRUksT0FBTyxHQUFHQSxPQUFPLENBQUND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