a3bfb0322c6ceeb3f0b3cd510414ebe7
"use strict";

exports.__esModule = true;
exports.default = createStyleResolver;
var _ExecutionEnvironment = require("fbjs/lib/ExecutionEnvironment");
var _createCSSStyleSheet = _interopRequireDefault(require("./createCSSStyleSheet"));
var _createCompileableStyle = _interopRequireDefault(require("./createCompileableStyle"));
var _createOrderedCSSStyleSheet = _interopRequireDefault(require("./createOrderedCSSStyleSheet"));
var _flattenArray = _interopRequireDefault(require("../../modules/flattenArray"));
var _flattenStyle = _interopRequireDefault(require("./flattenStyle"));
var _I18nManager = _interopRequireDefault(require("../I18nManager"));
var _i18nStyle = _interopRequireDefault(require("./i18nStyle"));
var _compile = require("./compile");
var _initialRules = _interopRequireDefault(require("./initialRules"));
var _modality = _interopRequireDefault(require("./modality"));
var _constants = require("./constants");
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
function createStyleResolver() {
  var inserted, sheet, cache;
  var resolved = {
    css: {},
    ltr: {},
    rtl: {},
    rtlNoSwap: {}
  };
  var init = function init() {
    inserted = {
      css: {},
      ltr: {},
      rtl: {},
      rtlNoSwap: {}
    };
    sheet = (0, _createOrderedCSSStyleSheet.default)((0, _createCSSStyleSheet.default)(_constants.STYLE_ELEMENT_ID));
    cache = {};
    (0, _modality.default)(function (rule) {
      return sheet.insert(rule, _constants.STYLE_GROUPS.modality);
    });
    _initialRules.default.forEach(function (rule) {
      sheet.insert(rule, _constants.STYLE_GROUPS.reset);
    });
  };
  init();
  function addToCache(className, prop, value) {
    if (!cache[prop]) {
      cache[prop] = {};
    }
    cache[prop][value] = className;
  }
  function getClassName(prop, value) {
    var val = (0, _compile.stringifyValueWithProperty)(value, prop);
    return cache[prop] && cache[prop].hasOwnProperty(val) && cache[prop][val];
  }
  function _injectRegisteredStyle(id) {
    var _I18nManager$getConst = _I18nManager.default.getConstants(),
      doLeftAndRightSwapInRTL = _I18nManager$getConst.doLeftAndRightSwapInRTL,
      isRTL = _I18nManager$getConst.isRTL;
    var dir = isRTL ? doLeftAndRightSwapInRTL ? 'rtl' : 'rtlNoSwap' : 'ltr';
    if (!inserted[dir][id]) {
      var style = (0, _createCompileableStyle.default)((0, _i18nStyle.default)((0, _flattenStyle.default)(id)));
      var results = (0, _compile.atomic)(style);
      Object.keys(results).forEach(function (key) {
        var _results$key = results[key],
          identifier = _results$key.identifier,
          property = _results$key.property,
          rules = _results$key.rules,
          value = _results$key.value;
        addToCache(identifier, property, value);
        rules.forEach(function (rule) {
          var group = _constants.STYLE_GROUPS.custom[property] || _constants.STYLE_GROUPS.atomic;
          sheet.insert(rule, group);
        });
      });
      inserted[dir][id] = true;
    }
  }
  function resolve(style, classList) {
    var nextClassList = [];
    var props = {};
    if (!style && !classList) {
      return props;
    }
    if (Array.isArray(classList)) {
      (0, _flattenArray.default)(classList).forEach(function (identifier) {
        if (identifier) {
          if (inserted.css[identifier] == null && resolved.css[identifier] != null) {
            var item = resolved.css[identifier];
            item.rules.forEach(function (rule) {
              sheet.insert(rule, item.group);
            });
            inserted.css[identifier] = true;
          }
          nextClassList.push(identifier);
        }
      });
    }
    if (typeof style === 'number') {
      _injectRegisteredStyle(style);
      var key = createCacheKey(style);
      props = _resolveStyle(style, key);
    } else if (!Array.isArray(style)) {
      props = _resolveStyle(style);
    } else {
      var flatArray = (0, _flattenArray.default)(style);
      var isArrayOfNumbers = true;
      var cacheKey = '';
      for (var i = 0; i < flatArray.length; i++) {
        var id = flatArray[i];
        if (typeof id !== 'number') {
          isArrayOfNumbers = false;
        } else {
          if (isArrayOfNumbers) {
            cacheKey += id + '-';
          }
          _injectRegisteredStyle(id);
        }
      }
      var _key = isArrayOfNumbers ? createCacheKey(cacheKey) : null;
      props = _resolveStyle(flatArray, _key);
    }
    nextClassList.push.apply(nextClassList, props.classList);
    var finalProps = {
      className: classListToString(nextClassList),
      classList: nextClassList
    };
    if (props.style) {
      finalProps.style = props.style;
    }
    return finalProps;
  }
  function _resolveStyle(style, key) {
    var _I18nManager$getConst2 = _I18nManager.default.getConstants(),
      doLeftAndRightSwapInRTL = _I18nManager$getConst2.doLeftAndRightSwapInRTL,
      isRTL = _I18nManager$getConst2.isRTL;
    var dir = isRTL ? doLeftAndRightSwapInRTL ? 'rtl' : 'rtlNoSwap' : 'ltr';
    if (key != null && resolved[dir][key] != null) {
      return resolved[dir][key];
    }
    var flatStyle = (0, _flattenStyle.default)(style);
    var localizedStyle = (0, _createCompileableStyle.default)((0, _i18nStyle.default)(flatStyle));
    var props = Object.keys(localizedStyle).sort().reduce(function (props, styleProp) {
      var value = localizedStyle[styleProp];
      if (value != null) {
        var className = getClassName(styleProp, value);
        if (className) {
          props.classList.push(className);
        } else {
          if (styleProp === 'animationKeyframes' || styleProp === 'placeholderTextColor' || styleProp === 'pointerEvents' || styleProp === 'scrollbarWidth') {
            var _atomic;
            var a = (0, _compile.atomic)((_atomic = {}, _atomic[styleProp] = value, _atomic));
            Object.keys(a).forEach(function (key) {
              var _a$key = a[key],
                identifier = _a$key.identifier,
                rules = _a$key.rules;
              props.classList.push(identifier);
              rules.forEach(function (rule) {
                sheet.insert(rule, _constants.STYLE_GROUPS.atomic);
              });
            });
          } else {
            if (!props.style) {
              props.style = {};
            }
            props.style[styleProp] = value;
          }
        }
      }
      return props;
    }, {
      classList: []
    });
    if (props.style) {
      props.style = (0, _compile.inline)(props.style);
    }
    if (key != null) {
      resolved[dir][key] = props;
    }
    return props;
  }
  return {
    getStyleSheet: function getStyleSheet() {
      var textContent = sheet.getTextContent();
      if (!_ExecutionEnvironment.canUseDOM) {
        init();
      }
      return {
        id: _constants.STYLE_ELEMENT_ID,
        textContent: textContent
      };
    },
    createCSS: function createCSS(rules, group) {
      var result = {};
      Object.keys(rules).forEach(function (name) {
        var style = rules[name];
        var compiled = (0, _compile.classic)(style, name);
        Object.keys(compiled).forEach(function (key) {
          var _compiled$key = compiled[key],
            identifier = _compiled$key.identifier,
            rules = _compiled$key.rules;
          resolved.css[identifier] = {
            group: group || _constants.STYLE_GROUPS.classic,
            rules: rules
          };
          result[name] = identifier;
        });
      });
      return result;
    },
    resolve: resolve,
    get sheet() {
      return sheet;
    }
  };
}
var createCacheKey = function createCacheKey(id) {
  var prefix = 'rn';
  return prefix + "-" + id;
};
var classListToString = function classListToString(list) {
  return list.join(' ').trim();
};
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJjcmVhdGVTdHlsZVJlc29sdmVyIiwiX0V4ZWN1dGlvbkVudmlyb25tZW50IiwicmVxdWlyZSIsIl9jcmVhdGVDU1NTdHlsZVNoZWV0IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9jcmVhdGVDb21waWxlYWJsZVN0eWxlIiwiX2NyZWF0ZU9yZGVyZWRDU1NTdHlsZVNoZWV0IiwiX2ZsYXR0ZW5BcnJheSIsIl9mbGF0dGVuU3R5bGUiLCJfSTE4bk1hbmFnZXIiLCJfaTE4blN0eWxlIiwiX2NvbXBpbGUiLCJfaW5pdGlhbFJ1bGVzIiwiX21vZGFsaXR5IiwiX2NvbnN0YW50cyIsIm9iaiIsImluc2VydGVkIiwic2hlZXQiLCJjYWNoZSIsInJlc29sdmVkIiwiY3NzIiwibHRyIiwicnRsIiwicnRsTm9Td2FwIiwiaW5pdCIsIlNUWUxFX0VMRU1FTlRfSUQiLCJydWxlIiwiaW5zZXJ0IiwiU1RZTEVfR1JPVVBTIiwibW9kYWxpdHkiLCJmb3JFYWNoIiwicmVzZXQiLCJhZGRUb0NhY2hlIiwiY2xhc3NOYW1lIiwicHJvcCIsInZhbHVlIiwiZ2V0Q2xhc3NOYW1lIiwidmFsIiwic3RyaW5naWZ5VmFsdWVXaXRoUHJvcGVydHkiLCJoYXNPd25Qcm9wZXJ0eSIsIl9pbmplY3RSZWdpc3RlcmVkU3R5bGUiLCJpZCIsIl9JMThuTWFuYWdlciRnZXRDb25zdCIsImdldENvbnN0YW50cyIsImRvTGVmdEFuZFJpZ2h0U3dhcEluUlRMIiwiaXNSVEwiLCJkaXIiLCJzdHlsZSIsInJlc3VsdHMiLCJhdG9taWMiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiX3Jlc3VsdHMka2V5IiwiaWRlbnRpZmllciIsInByb3BlcnR5IiwicnVsZXMiLCJncm91cCIsImN1c3RvbSIsInJlc29sdmUiLCJjbGFzc0xpc3QiLCJuZXh0Q2xhc3NMaXN0IiwicHJvcHMiLCJBcnJheSIsImlzQXJyYXkiLCJpdGVtIiwicHVzaCIsImNyZWF0ZUNhY2hlS2V5IiwiX3Jlc29sdmVTdHlsZSIsImZsYXRBcnJheSIsImlzQXJyYXlPZk51bWJlcnMiLCJjYWNoZUtleSIsImkiLCJsZW5ndGgiLCJfa2V5IiwiYXBwbHkiLCJmaW5hbFByb3BzIiwiY2xhc3NMaXN0VG9TdHJpbmciLCJfSTE4bk1hbmFnZXIkZ2V0Q29uc3QyIiwiZmxhdFN0eWxlIiwibG9jYWxpemVkU3R5bGUiLCJzb3J0IiwicmVkdWNlIiwic3R5bGVQcm9wIiwiX2F0b21pYyIsImEiLCJfYSRrZXkiLCJpbmxpbmUiLCJnZXRTdHlsZVNoZWV0IiwidGV4dENvbnRlbnQiLCJnZXRUZXh0Q29udGVudCIsImNhblVzZURPTSIsImNyZWF0ZUNTUyIsInJlc3VsdCIsIm5hbWUiLCJjb21waWxlZCIsImNsYXNzaWMiLCJfY29tcGlsZWQka2V5IiwicHJlZml4IiwibGlzdCIsImpvaW4iLCJ0cmltIiwibW9kdWxlIl0sInNvdXJjZXMiOlsiY3JlYXRlU3R5bGVSZXNvbHZlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IGNyZWF0ZVN0eWxlUmVzb2x2ZXI7XG5cbnZhciBfRXhlY3V0aW9uRW52aXJvbm1lbnQgPSByZXF1aXJlKFwiZmJqcy9saWIvRXhlY3V0aW9uRW52aXJvbm1lbnRcIik7XG5cbnZhciBfY3JlYXRlQ1NTU3R5bGVTaGVldCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY3JlYXRlQ1NTU3R5bGVTaGVldFwiKSk7XG5cbnZhciBfY3JlYXRlQ29tcGlsZWFibGVTdHlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY3JlYXRlQ29tcGlsZWFibGVTdHlsZVwiKSk7XG5cbnZhciBfY3JlYXRlT3JkZXJlZENTU1N0eWxlU2hlZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2NyZWF0ZU9yZGVyZWRDU1NTdHlsZVNoZWV0XCIpKTtcblxudmFyIF9mbGF0dGVuQXJyYXkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi8uLi9tb2R1bGVzL2ZsYXR0ZW5BcnJheVwiKSk7XG5cbnZhciBfZmxhdHRlblN0eWxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9mbGF0dGVuU3R5bGVcIikpO1xuXG52YXIgX0kxOG5NYW5hZ2VyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vSTE4bk1hbmFnZXJcIikpO1xuXG52YXIgX2kxOG5TdHlsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vaTE4blN0eWxlXCIpKTtcblxudmFyIF9jb21waWxlID0gcmVxdWlyZShcIi4vY29tcGlsZVwiKTtcblxudmFyIF9pbml0aWFsUnVsZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2luaXRpYWxSdWxlc1wiKSk7XG5cbnZhciBfbW9kYWxpdHkgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL21vZGFsaXR5XCIpKTtcblxudmFyIF9jb25zdGFudHMgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbi8qKlxuICogQ29weXJpZ2h0IChjKSBOaWNvbGFzIEdhbGxhZ2hlci5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBcbiAqL1xuXG4vKipcbiAqIFdBUk5JTkc6IGNoYW5nZXMgdG8gdGhpcyBmaWxlIGluIHBhcnRpY3VsYXIgY2FuIGNhdXNlIHNpZ25pZmljYW50IGNoYW5nZXMgdG9cbiAqIHRoZSByZXN1bHRzIG9mIHJlbmRlciBwZXJmb3JtYW5jZSBiZW5jaG1hcmtzLlxuICovXG5mdW5jdGlvbiBjcmVhdGVTdHlsZVJlc29sdmVyKCkge1xuICB2YXIgaW5zZXJ0ZWQsIHNoZWV0LCBjYWNoZTtcbiAgdmFyIHJlc29sdmVkID0ge1xuICAgIGNzczoge30sXG4gICAgbHRyOiB7fSxcbiAgICBydGw6IHt9LFxuICAgIHJ0bE5vU3dhcDoge31cbiAgfTtcblxuICB2YXIgaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgaW5zZXJ0ZWQgPSB7XG4gICAgICBjc3M6IHt9LFxuICAgICAgbHRyOiB7fSxcbiAgICAgIHJ0bDoge30sXG4gICAgICBydGxOb1N3YXA6IHt9XG4gICAgfTtcbiAgICBzaGVldCA9ICgwLCBfY3JlYXRlT3JkZXJlZENTU1N0eWxlU2hlZXQuZGVmYXVsdCkoKDAsIF9jcmVhdGVDU1NTdHlsZVNoZWV0LmRlZmF1bHQpKF9jb25zdGFudHMuU1RZTEVfRUxFTUVOVF9JRCkpO1xuICAgIGNhY2hlID0ge307XG4gICAgKDAsIF9tb2RhbGl0eS5kZWZhdWx0KShmdW5jdGlvbiAocnVsZSkge1xuICAgICAgcmV0dXJuIHNoZWV0Lmluc2VydChydWxlLCBfY29uc3RhbnRzLlNUWUxFX0dST1VQUy5tb2RhbGl0eSk7XG4gICAgfSk7XG5cbiAgICBfaW5pdGlhbFJ1bGVzLmRlZmF1bHQuZm9yRWFjaChmdW5jdGlvbiAocnVsZSkge1xuICAgICAgc2hlZXQuaW5zZXJ0KHJ1bGUsIF9jb25zdGFudHMuU1RZTEVfR1JPVVBTLnJlc2V0KTtcbiAgICB9KTtcbiAgfTtcblxuICBpbml0KCk7XG5cbiAgZnVuY3Rpb24gYWRkVG9DYWNoZShjbGFzc05hbWUsIHByb3AsIHZhbHVlKSB7XG4gICAgaWYgKCFjYWNoZVtwcm9wXSkge1xuICAgICAgY2FjaGVbcHJvcF0gPSB7fTtcbiAgICB9XG5cbiAgICBjYWNoZVtwcm9wXVt2YWx1ZV0gPSBjbGFzc05hbWU7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDbGFzc05hbWUocHJvcCwgdmFsdWUpIHtcbiAgICB2YXIgdmFsID0gKDAsIF9jb21waWxlLnN0cmluZ2lmeVZhbHVlV2l0aFByb3BlcnR5KSh2YWx1ZSwgcHJvcCk7XG4gICAgcmV0dXJuIGNhY2hlW3Byb3BdICYmIGNhY2hlW3Byb3BdLmhhc093blByb3BlcnR5KHZhbCkgJiYgY2FjaGVbcHJvcF1bdmFsXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9pbmplY3RSZWdpc3RlcmVkU3R5bGUoaWQpIHtcbiAgICB2YXIgX0kxOG5NYW5hZ2VyJGdldENvbnN0ID0gX0kxOG5NYW5hZ2VyLmRlZmF1bHQuZ2V0Q29uc3RhbnRzKCksXG4gICAgICAgIGRvTGVmdEFuZFJpZ2h0U3dhcEluUlRMID0gX0kxOG5NYW5hZ2VyJGdldENvbnN0LmRvTGVmdEFuZFJpZ2h0U3dhcEluUlRMLFxuICAgICAgICBpc1JUTCA9IF9JMThuTWFuYWdlciRnZXRDb25zdC5pc1JUTDtcblxuICAgIHZhciBkaXIgPSBpc1JUTCA/IGRvTGVmdEFuZFJpZ2h0U3dhcEluUlRMID8gJ3J0bCcgOiAncnRsTm9Td2FwJyA6ICdsdHInO1xuXG4gICAgaWYgKCFpbnNlcnRlZFtkaXJdW2lkXSkge1xuICAgICAgdmFyIHN0eWxlID0gKDAsIF9jcmVhdGVDb21waWxlYWJsZVN0eWxlLmRlZmF1bHQpKCgwLCBfaTE4blN0eWxlLmRlZmF1bHQpKCgwLCBfZmxhdHRlblN0eWxlLmRlZmF1bHQpKGlkKSkpO1xuICAgICAgdmFyIHJlc3VsdHMgPSAoMCwgX2NvbXBpbGUuYXRvbWljKShzdHlsZSk7XG4gICAgICBPYmplY3Qua2V5cyhyZXN1bHRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyIF9yZXN1bHRzJGtleSA9IHJlc3VsdHNba2V5XSxcbiAgICAgICAgICAgIGlkZW50aWZpZXIgPSBfcmVzdWx0cyRrZXkuaWRlbnRpZmllcixcbiAgICAgICAgICAgIHByb3BlcnR5ID0gX3Jlc3VsdHMka2V5LnByb3BlcnR5LFxuICAgICAgICAgICAgcnVsZXMgPSBfcmVzdWx0cyRrZXkucnVsZXMsXG4gICAgICAgICAgICB2YWx1ZSA9IF9yZXN1bHRzJGtleS52YWx1ZTtcbiAgICAgICAgYWRkVG9DYWNoZShpZGVudGlmaWVyLCBwcm9wZXJ0eSwgdmFsdWUpO1xuICAgICAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgICAgdmFyIGdyb3VwID0gX2NvbnN0YW50cy5TVFlMRV9HUk9VUFMuY3VzdG9tW3Byb3BlcnR5XSB8fCBfY29uc3RhbnRzLlNUWUxFX0dST1VQUy5hdG9taWM7XG4gICAgICAgICAgc2hlZXQuaW5zZXJ0KHJ1bGUsIGdyb3VwKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGluc2VydGVkW2Rpcl1baWRdID0gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFJlc29sdmVzIGEgUmVhY3QgTmF0aXZlIHN0eWxlIG9iamVjdCB0byBET00gYXR0cmlidXRlc1xuICAgKi9cblxuXG4gIGZ1bmN0aW9uIHJlc29sdmUoc3R5bGUsIGNsYXNzTGlzdCkge1xuICAgIHZhciBuZXh0Q2xhc3NMaXN0ID0gW107XG4gICAgdmFyIHByb3BzID0ge307XG5cbiAgICBpZiAoIXN0eWxlICYmICFjbGFzc0xpc3QpIHtcbiAgICAgIHJldHVybiBwcm9wcztcbiAgICB9XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShjbGFzc0xpc3QpKSB7XG4gICAgICAoMCwgX2ZsYXR0ZW5BcnJheS5kZWZhdWx0KShjbGFzc0xpc3QpLmZvckVhY2goZnVuY3Rpb24gKGlkZW50aWZpZXIpIHtcbiAgICAgICAgaWYgKGlkZW50aWZpZXIpIHtcbiAgICAgICAgICBpZiAoaW5zZXJ0ZWQuY3NzW2lkZW50aWZpZXJdID09IG51bGwgJiYgcmVzb2x2ZWQuY3NzW2lkZW50aWZpZXJdICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBpdGVtID0gcmVzb2x2ZWQuY3NzW2lkZW50aWZpZXJdO1xuICAgICAgICAgICAgaXRlbS5ydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgICAgICAgIHNoZWV0Lmluc2VydChydWxlLCBpdGVtLmdyb3VwKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW5zZXJ0ZWQuY3NzW2lkZW50aWZpZXJdID0gdHJ1ZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBuZXh0Q2xhc3NMaXN0LnB1c2goaWRlbnRpZmllcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygc3R5bGUgPT09ICdudW1iZXInKSB7XG4gICAgICAvLyBmYXN0IGFuZCBjYWNoYWJsZVxuICAgICAgX2luamVjdFJlZ2lzdGVyZWRTdHlsZShzdHlsZSk7XG5cbiAgICAgIHZhciBrZXkgPSBjcmVhdGVDYWNoZUtleShzdHlsZSk7XG4gICAgICBwcm9wcyA9IF9yZXNvbHZlU3R5bGUoc3R5bGUsIGtleSk7XG4gICAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShzdHlsZSkpIHtcbiAgICAgIC8vIHJlc29sdmUgYSBwbGFpbiBSTiBzdHlsZSBvYmplY3RcbiAgICAgIHByb3BzID0gX3Jlc29sdmVTdHlsZShzdHlsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGZsYXR0ZW4gdGhlIHN0eWxlIGFycmF5XG4gICAgICAvLyBjYWNoZSByZXNvbHZlZCBwcm9wcyB3aGVuIGFsbCBzdHlsZXMgYXJlIHJlZ2lzdGVyZWRcbiAgICAgIC8vIG90aGVyd2lzZSBmYWxsYmFjayB0byByZXNvbHZpbmdcbiAgICAgIHZhciBmbGF0QXJyYXkgPSAoMCwgX2ZsYXR0ZW5BcnJheS5kZWZhdWx0KShzdHlsZSk7XG4gICAgICB2YXIgaXNBcnJheU9mTnVtYmVycyA9IHRydWU7XG4gICAgICB2YXIgY2FjaGVLZXkgPSAnJztcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmbGF0QXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGlkID0gZmxhdEFycmF5W2ldO1xuXG4gICAgICAgIGlmICh0eXBlb2YgaWQgIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgaXNBcnJheU9mTnVtYmVycyA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChpc0FycmF5T2ZOdW1iZXJzKSB7XG4gICAgICAgICAgICBjYWNoZUtleSArPSBpZCArICctJztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBfaW5qZWN0UmVnaXN0ZXJlZFN0eWxlKGlkKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgX2tleSA9IGlzQXJyYXlPZk51bWJlcnMgPyBjcmVhdGVDYWNoZUtleShjYWNoZUtleSkgOiBudWxsO1xuXG4gICAgICBwcm9wcyA9IF9yZXNvbHZlU3R5bGUoZmxhdEFycmF5LCBfa2V5KTtcbiAgICB9XG5cbiAgICBuZXh0Q2xhc3NMaXN0LnB1c2guYXBwbHkobmV4dENsYXNzTGlzdCwgcHJvcHMuY2xhc3NMaXN0KTtcbiAgICB2YXIgZmluYWxQcm9wcyA9IHtcbiAgICAgIGNsYXNzTmFtZTogY2xhc3NMaXN0VG9TdHJpbmcobmV4dENsYXNzTGlzdCksXG4gICAgICBjbGFzc0xpc3Q6IG5leHRDbGFzc0xpc3RcbiAgICB9O1xuXG4gICAgaWYgKHByb3BzLnN0eWxlKSB7XG4gICAgICBmaW5hbFByb3BzLnN0eWxlID0gcHJvcHMuc3R5bGU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZpbmFsUHJvcHM7XG4gIH1cbiAgLyoqXG4gICAqIFJlc29sdmVzIGEgUmVhY3QgTmF0aXZlIHN0eWxlIG9iamVjdFxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIF9yZXNvbHZlU3R5bGUoc3R5bGUsIGtleSkge1xuICAgIHZhciBfSTE4bk1hbmFnZXIkZ2V0Q29uc3QyID0gX0kxOG5NYW5hZ2VyLmRlZmF1bHQuZ2V0Q29uc3RhbnRzKCksXG4gICAgICAgIGRvTGVmdEFuZFJpZ2h0U3dhcEluUlRMID0gX0kxOG5NYW5hZ2VyJGdldENvbnN0Mi5kb0xlZnRBbmRSaWdodFN3YXBJblJUTCxcbiAgICAgICAgaXNSVEwgPSBfSTE4bk1hbmFnZXIkZ2V0Q29uc3QyLmlzUlRMO1xuXG4gICAgdmFyIGRpciA9IGlzUlRMID8gZG9MZWZ0QW5kUmlnaHRTd2FwSW5SVEwgPyAncnRsJyA6ICdydGxOb1N3YXAnIDogJ2x0cic7IC8vIGZhc3RlcjogbWVtb2l6ZWRcblxuICAgIGlmIChrZXkgIT0gbnVsbCAmJiByZXNvbHZlZFtkaXJdW2tleV0gIT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHJlc29sdmVkW2Rpcl1ba2V5XTtcbiAgICB9XG5cbiAgICB2YXIgZmxhdFN0eWxlID0gKDAsIF9mbGF0dGVuU3R5bGUuZGVmYXVsdCkoc3R5bGUpO1xuICAgIHZhciBsb2NhbGl6ZWRTdHlsZSA9ICgwLCBfY3JlYXRlQ29tcGlsZWFibGVTdHlsZS5kZWZhdWx0KSgoMCwgX2kxOG5TdHlsZS5kZWZhdWx0KShmbGF0U3R5bGUpKTsgLy8gc2xvd2VyOiBjb252ZXJ0IHN0eWxlIG9iamVjdCB0byBwcm9wcyBhbmQgY2FjaGVcblxuICAgIHZhciBwcm9wcyA9IE9iamVjdC5rZXlzKGxvY2FsaXplZFN0eWxlKS5zb3J0KCkucmVkdWNlKGZ1bmN0aW9uIChwcm9wcywgc3R5bGVQcm9wKSB7XG4gICAgICB2YXIgdmFsdWUgPSBsb2NhbGl6ZWRTdHlsZVtzdHlsZVByb3BdO1xuXG4gICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICB2YXIgY2xhc3NOYW1lID0gZ2V0Q2xhc3NOYW1lKHN0eWxlUHJvcCwgdmFsdWUpO1xuXG4gICAgICAgIGlmIChjbGFzc05hbWUpIHtcbiAgICAgICAgICBwcm9wcy5jbGFzc0xpc3QucHVzaChjbGFzc05hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIENlcnRhaW4gcHJvcGVydGllcyBhbmQgdmFsdWVzIGFyZSBub3QgdHJhbnNmb3JtZWQgYnkgJ2NyZWF0ZVJlYWN0RE9NU3R5bGUnIGFzIHRoZXlcbiAgICAgICAgICAvLyByZXF1aXJlIG1vcmUgY29tcGxleCB0cmFuc2Zvcm1zIGludG8gbXVsdGlwbGUgQ1NTIHJ1bGVzLiBIZXJlIHdlIGFzc3VtZSB0aGF0IFN0eWxlTWFuYWdlclxuICAgICAgICAgIC8vIGNhbiBiaW5kIHRoZXNlIHN0eWxlcyB0byBhIGNsYXNzTmFtZSwgYW5kIHByZXZlbnQgdGhlbSBiZWNvbWluZyBpbnZhbGlkIGlubGluZS1zdHlsZXMuXG4gICAgICAgICAgaWYgKHN0eWxlUHJvcCA9PT0gJ2FuaW1hdGlvbktleWZyYW1lcycgfHwgc3R5bGVQcm9wID09PSAncGxhY2Vob2xkZXJUZXh0Q29sb3InIHx8IHN0eWxlUHJvcCA9PT0gJ3BvaW50ZXJFdmVudHMnIHx8IHN0eWxlUHJvcCA9PT0gJ3Njcm9sbGJhcldpZHRoJykge1xuICAgICAgICAgICAgdmFyIF9hdG9taWM7XG5cbiAgICAgICAgICAgIHZhciBhID0gKDAsIF9jb21waWxlLmF0b21pYykoKF9hdG9taWMgPSB7fSwgX2F0b21pY1tzdHlsZVByb3BdID0gdmFsdWUsIF9hdG9taWMpKTtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGEpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgICB2YXIgX2Eka2V5ID0gYVtrZXldLFxuICAgICAgICAgICAgICAgICAgaWRlbnRpZmllciA9IF9hJGtleS5pZGVudGlmaWVyLFxuICAgICAgICAgICAgICAgICAgcnVsZXMgPSBfYSRrZXkucnVsZXM7XG4gICAgICAgICAgICAgIHByb3BzLmNsYXNzTGlzdC5wdXNoKGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgICAgICAgICAgc2hlZXQuaW5zZXJ0KHJ1bGUsIF9jb25zdGFudHMuU1RZTEVfR1JPVVBTLmF0b21pYyk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghcHJvcHMuc3R5bGUpIHtcbiAgICAgICAgICAgICAgcHJvcHMuc3R5bGUgPSB7fTtcbiAgICAgICAgICAgIH0gLy8gNHggc2xvd2VyIHJlbmRlclxuXG5cbiAgICAgICAgICAgIHByb3BzLnN0eWxlW3N0eWxlUHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByb3BzO1xuICAgIH0sIHtcbiAgICAgIGNsYXNzTGlzdDogW11cbiAgICB9KTtcblxuICAgIGlmIChwcm9wcy5zdHlsZSkge1xuICAgICAgcHJvcHMuc3R5bGUgPSAoMCwgX2NvbXBpbGUuaW5saW5lKShwcm9wcy5zdHlsZSk7XG4gICAgfVxuXG4gICAgaWYgKGtleSAhPSBudWxsKSB7XG4gICAgICByZXNvbHZlZFtkaXJdW2tleV0gPSBwcm9wcztcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdldFN0eWxlU2hlZXQ6IGZ1bmN0aW9uIGdldFN0eWxlU2hlZXQoKSB7XG4gICAgICB2YXIgdGV4dENvbnRlbnQgPSBzaGVldC5nZXRUZXh0Q29udGVudCgpOyAvLyBSZXNldCBzdGF0ZSBvbiB0aGUgc2VydmVyIHNvIGNyaXRpY2FsIGNzcyBpcyBhbHdheXMgdGhlIHJlc3VsdFxuXG4gICAgICBpZiAoIV9FeGVjdXRpb25FbnZpcm9ubWVudC5jYW5Vc2VET00pIHtcbiAgICAgICAgaW5pdCgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogX2NvbnN0YW50cy5TVFlMRV9FTEVNRU5UX0lELFxuICAgICAgICB0ZXh0Q29udGVudDogdGV4dENvbnRlbnRcbiAgICAgIH07XG4gICAgfSxcbiAgICBjcmVhdGVDU1M6IGZ1bmN0aW9uIGNyZWF0ZUNTUyhydWxlcywgZ3JvdXApIHtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIE9iamVjdC5rZXlzKHJ1bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHZhciBzdHlsZSA9IHJ1bGVzW25hbWVdO1xuICAgICAgICB2YXIgY29tcGlsZWQgPSAoMCwgX2NvbXBpbGUuY2xhc3NpYykoc3R5bGUsIG5hbWUpO1xuICAgICAgICBPYmplY3Qua2V5cyhjb21waWxlZCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgdmFyIF9jb21waWxlZCRrZXkgPSBjb21waWxlZFtrZXldLFxuICAgICAgICAgICAgICBpZGVudGlmaWVyID0gX2NvbXBpbGVkJGtleS5pZGVudGlmaWVyLFxuICAgICAgICAgICAgICBydWxlcyA9IF9jb21waWxlZCRrZXkucnVsZXM7XG4gICAgICAgICAgcmVzb2x2ZWQuY3NzW2lkZW50aWZpZXJdID0ge1xuICAgICAgICAgICAgZ3JvdXA6IGdyb3VwIHx8IF9jb25zdGFudHMuU1RZTEVfR1JPVVBTLmNsYXNzaWMsXG4gICAgICAgICAgICBydWxlczogcnVsZXNcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJlc3VsdFtuYW1lXSA9IGlkZW50aWZpZXI7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgcmVzb2x2ZTogcmVzb2x2ZSxcblxuICAgIGdldCBzaGVldCgpIHtcbiAgICAgIHJldHVybiBzaGVldDtcbiAgICB9XG5cbiAgfTtcbn1cbi8qKlxuICogTWlzYyBoZWxwZXJzXG4gKi9cblxuXG52YXIgY3JlYXRlQ2FjaGVLZXkgPSBmdW5jdGlvbiBjcmVhdGVDYWNoZUtleShpZCkge1xuICB2YXIgcHJlZml4ID0gJ3JuJztcbiAgcmV0dXJuIHByZWZpeCArIFwiLVwiICsgaWQ7XG59O1xuXG52YXIgY2xhc3NMaXN0VG9TdHJpbmcgPSBmdW5jdGlvbiBjbGFzc0xpc3RUb1N0cmluZyhsaXN0KSB7XG4gIHJldHVybiBsaXN0LmpvaW4oJyAnKS50cmltKCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVs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