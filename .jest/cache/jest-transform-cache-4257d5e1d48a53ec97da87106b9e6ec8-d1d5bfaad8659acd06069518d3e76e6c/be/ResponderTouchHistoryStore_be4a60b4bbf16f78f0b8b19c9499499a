2af02af70f86f6c674b21d8956699fdf
"use strict";

exports.__esModule = true;
exports.default = void 0;
var _ResponderEventTypes = require("./ResponderEventTypes");
var __DEV__ = process.env.NODE_ENV !== 'production';
var MAX_TOUCH_BANK = 20;
var touchBank = [];
var touchHistory = {
  touchBank: touchBank,
  numberActiveTouches: 0,
  indexOfSingleActiveTouch: -1,
  mostRecentTimeStamp: 0
};
function timestampForTouch(touch) {
  return touch.timeStamp || touch.timestamp;
}
function createTouchRecord(touch) {
  return {
    touchActive: true,
    startPageX: touch.pageX,
    startPageY: touch.pageY,
    startTimeStamp: timestampForTouch(touch),
    currentPageX: touch.pageX,
    currentPageY: touch.pageY,
    currentTimeStamp: timestampForTouch(touch),
    previousPageX: touch.pageX,
    previousPageY: touch.pageY,
    previousTimeStamp: timestampForTouch(touch)
  };
}
function resetTouchRecord(touchRecord, touch) {
  touchRecord.touchActive = true;
  touchRecord.startPageX = touch.pageX;
  touchRecord.startPageY = touch.pageY;
  touchRecord.startTimeStamp = timestampForTouch(touch);
  touchRecord.currentPageX = touch.pageX;
  touchRecord.currentPageY = touch.pageY;
  touchRecord.currentTimeStamp = timestampForTouch(touch);
  touchRecord.previousPageX = touch.pageX;
  touchRecord.previousPageY = touch.pageY;
  touchRecord.previousTimeStamp = timestampForTouch(touch);
}
function getTouchIdentifier(_ref) {
  var identifier = _ref.identifier;
  if (identifier == null) {
    console.error('Touch object is missing identifier.');
  }
  if (__DEV__) {
    if (identifier > MAX_TOUCH_BANK) {
      console.error('Touch identifier %s is greater than maximum supported %s which causes ' + 'performance issues backfilling array locations for all of the indices.', identifier, MAX_TOUCH_BANK);
    }
  }
  return identifier;
}
function recordTouchStart(touch) {
  var identifier = getTouchIdentifier(touch);
  var touchRecord = touchBank[identifier];
  if (touchRecord) {
    resetTouchRecord(touchRecord, touch);
  } else {
    touchBank[identifier] = createTouchRecord(touch);
  }
  touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
}
function recordTouchMove(touch) {
  var touchRecord = touchBank[getTouchIdentifier(touch)];
  if (touchRecord) {
    touchRecord.touchActive = true;
    touchRecord.previousPageX = touchRecord.currentPageX;
    touchRecord.previousPageY = touchRecord.currentPageY;
    touchRecord.previousTimeStamp = touchRecord.currentTimeStamp;
    touchRecord.currentPageX = touch.pageX;
    touchRecord.currentPageY = touch.pageY;
    touchRecord.currentTimeStamp = timestampForTouch(touch);
    touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
  } else {
    console.warn('Cannot record touch move without a touch start.\n', "Touch Move: " + printTouch(touch) + "\n", "Touch Bank: " + printTouchBank());
  }
}
function recordTouchEnd(touch) {
  var touchRecord = touchBank[getTouchIdentifier(touch)];
  if (touchRecord) {
    touchRecord.touchActive = false;
    touchRecord.previousPageX = touchRecord.currentPageX;
    touchRecord.previousPageY = touchRecord.currentPageY;
    touchRecord.previousTimeStamp = touchRecord.currentTimeStamp;
    touchRecord.currentPageX = touch.pageX;
    touchRecord.currentPageY = touch.pageY;
    touchRecord.currentTimeStamp = timestampForTouch(touch);
    touchHistory.mostRecentTimeStamp = timestampForTouch(touch);
  } else {
    console.warn('Cannot record touch end without a touch start.\n', "Touch End: " + printTouch(touch) + "\n", "Touch Bank: " + printTouchBank());
  }
}
function printTouch(touch) {
  return JSON.stringify({
    identifier: touch.identifier,
    pageX: touch.pageX,
    pageY: touch.pageY,
    timestamp: timestampForTouch(touch)
  });
}
function printTouchBank() {
  var printed = JSON.stringify(touchBank.slice(0, MAX_TOUCH_BANK));
  if (touchBank.length > MAX_TOUCH_BANK) {
    printed += ' (original size: ' + touchBank.length + ')';
  }
  return printed;
}
var ResponderTouchHistoryStore = {
  recordTouchTrack: function recordTouchTrack(topLevelType, nativeEvent) {
    if ((0, _ResponderEventTypes.isMoveish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchMove);
    } else if ((0, _ResponderEventTypes.isStartish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchStart);
      touchHistory.numberActiveTouches = nativeEvent.touches.length;
      if (touchHistory.numberActiveTouches === 1) {
        touchHistory.indexOfSingleActiveTouch = nativeEvent.touches[0].identifier;
      }
    } else if ((0, _ResponderEventTypes.isEndish)(topLevelType)) {
      nativeEvent.changedTouches.forEach(recordTouchEnd);
      touchHistory.numberActiveTouches = nativeEvent.touches.length;
      if (touchHistory.numberActiveTouches === 1) {
        for (var i = 0; i < touchBank.length; i++) {
          var touchTrackToCheck = touchBank[i];
          if (touchTrackToCheck != null && touchTrackToCheck.touchActive) {
            touchHistory.indexOfSingleActiveTouch = i;
            break;
          }
        }
        if (__DEV__) {
          var activeRecord = touchBank[touchHistory.indexOfSingleActiveTouch];
          if (!(activeRecord != null && activeRecord.touchActive)) {
            console.error('Cannot find single active touch.');
          }
        }
      }
    }
  },
  touchHistory: touchHistory
};
var _default = ResponderTouchHistoryStore;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJfUmVzcG9uZGVyRXZlbnRUeXBlcyIsInJlcXVpcmUiLCJfX0RFVl9fIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiTUFYX1RPVUNIX0JBTksiLCJ0b3VjaEJhbmsiLCJ0b3VjaEhpc3RvcnkiLCJudW1iZXJBY3RpdmVUb3VjaGVzIiwiaW5kZXhPZlNpbmdsZUFjdGl2ZVRvdWNoIiwibW9zdFJlY2VudFRpbWVTdGFtcCIsInRpbWVzdGFtcEZvclRvdWNoIiwidG91Y2giLCJ0aW1lU3RhbXAiLCJ0aW1lc3RhbXAiLCJjcmVhdGVUb3VjaFJlY29yZCIsInRvdWNoQWN0aXZlIiwic3RhcnRQYWdlWCIsInBhZ2VYIiwic3RhcnRQYWdlWSIsInBhZ2VZIiwic3RhcnRUaW1lU3RhbXAiLCJjdXJyZW50UGFnZVgiLCJjdXJyZW50UGFnZVkiLCJjdXJyZW50VGltZVN0YW1wIiwicHJldmlvdXNQYWdlWCIsInByZXZpb3VzUGFnZVkiLCJwcmV2aW91c1RpbWVTdGFtcCIsInJlc2V0VG91Y2hSZWNvcmQiLCJ0b3VjaFJlY29yZCIsImdldFRvdWNoSWRlbnRpZmllciIsIl9yZWYiLCJpZGVudGlmaWVyIiwiY29uc29sZSIsImVycm9yIiwicmVjb3JkVG91Y2hTdGFydCIsInJlY29yZFRvdWNoTW92ZSIsIndhcm4iLCJwcmludFRvdWNoIiwicHJpbnRUb3VjaEJhbmsiLCJyZWNvcmRUb3VjaEVuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwcmludGVkIiwic2xpY2UiLCJsZW5ndGgiLCJSZXNwb25kZXJUb3VjaEhpc3RvcnlTdG9yZSIsInJlY29yZFRvdWNoVHJhY2siLCJ0b3BMZXZlbFR5cGUiLCJuYXRpdmVFdmVudCIsImlzTW92ZWlzaCIsImNoYW5nZWRUb3VjaGVzIiwiZm9yRWFjaCIsImlzU3RhcnRpc2giLCJ0b3VjaGVzIiwiaXNFbmRpc2giLCJpIiwidG91Y2hUcmFja1RvQ2hlY2siLCJhY3RpdmVSZWNvcmQiLCJfZGVmYXVsdCIsIm1vZHVsZSJdLCJzb3VyY2VzIjpbIlJlc3BvbmRlclRvdWNoSGlzdG9yeVN0b3JlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX1Jlc3BvbmRlckV2ZW50VHlwZXMgPSByZXF1aXJlKFwiLi9SZXNwb25kZXJFdmVudFR5cGVzXCIpO1xuXG4vKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIFxuICovXG5cbi8qKlxuICogVHJhY2tzIHRoZSBwb3NpdGlvbiBhbmQgdGltZSBvZiBlYWNoIGFjdGl2ZSB0b3VjaCBieSBgdG91Y2guaWRlbnRpZmllcmAuIFdlXG4gKiBzaG91bGQgdHlwaWNhbGx5IG9ubHkgc2VlIElEcyBpbiB0aGUgcmFuZ2Ugb2YgMS0yMCBiZWNhdXNlIElEcyBnZXQgcmVjeWNsZWRcbiAqIHdoZW4gdG91Y2hlcyBlbmQgYW5kIHN0YXJ0IGFnYWluLlxuICovXG52YXIgX19ERVZfXyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbic7XG5cbnZhciBNQVhfVE9VQ0hfQkFOSyA9IDIwO1xudmFyIHRvdWNoQmFuayA9IFtdO1xudmFyIHRvdWNoSGlzdG9yeSA9IHtcbiAgdG91Y2hCYW5rOiB0b3VjaEJhbmssXG4gIG51bWJlckFjdGl2ZVRvdWNoZXM6IDAsXG4gIC8vIElmIHRoZXJlIGlzIG9ubHkgb25lIGFjdGl2ZSB0b3VjaCwgd2UgcmVtZW1iZXIgaXRzIGxvY2F0aW9uLiBUaGlzIHByZXZlbnRzXG4gIC8vIHVzIGhhdmluZyB0byBsb29wIHRocm91Z2ggYWxsIG9mIHRoZSB0b3VjaGVzIGFsbCB0aGUgdGltZSBpbiB0aGUgbW9zdFxuICAvLyBjb21tb24gY2FzZS5cbiAgaW5kZXhPZlNpbmdsZUFjdGl2ZVRvdWNoOiAtMSxcbiAgbW9zdFJlY2VudFRpbWVTdGFtcDogMFxufTtcblxuZnVuY3Rpb24gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpIHtcbiAgLy8gVGhlIGxlZ2FjeSBpbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBwcm92aWRlcyBcInRpbWVTdGFtcFwiLCB3aGljaCBoYXMgYmVlblxuICAvLyByZW5hbWVkIHRvIFwidGltZXN0YW1wXCIuXG4gIHJldHVybiB0b3VjaC50aW1lU3RhbXAgfHwgdG91Y2gudGltZXN0YW1wO1xufVxuLyoqXG4gKiBUT0RPOiBJbnN0ZWFkIG9mIG1ha2luZyBnZXN0dXJlcyByZWNvbXB1dGUgZmlsdGVyZWQgdmVsb2NpdHksIHdlIGNvdWxkXG4gKiBpbmNsdWRlIGEgYnVpbHQgaW4gdmVsb2NpdHkgY29tcHV0YXRpb24gdGhhdCBjYW4gYmUgcmV1c2VkIGdsb2JhbGx5LlxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlVG91Y2hSZWNvcmQodG91Y2gpIHtcbiAgcmV0dXJuIHtcbiAgICB0b3VjaEFjdGl2ZTogdHJ1ZSxcbiAgICBzdGFydFBhZ2VYOiB0b3VjaC5wYWdlWCxcbiAgICBzdGFydFBhZ2VZOiB0b3VjaC5wYWdlWSxcbiAgICBzdGFydFRpbWVTdGFtcDogdGltZXN0YW1wRm9yVG91Y2godG91Y2gpLFxuICAgIGN1cnJlbnRQYWdlWDogdG91Y2gucGFnZVgsXG4gICAgY3VycmVudFBhZ2VZOiB0b3VjaC5wYWdlWSxcbiAgICBjdXJyZW50VGltZVN0YW1wOiB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaCksXG4gICAgcHJldmlvdXNQYWdlWDogdG91Y2gucGFnZVgsXG4gICAgcHJldmlvdXNQYWdlWTogdG91Y2gucGFnZVksXG4gICAgcHJldmlvdXNUaW1lU3RhbXA6IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKVxuICB9O1xufVxuXG5mdW5jdGlvbiByZXNldFRvdWNoUmVjb3JkKHRvdWNoUmVjb3JkLCB0b3VjaCkge1xuICB0b3VjaFJlY29yZC50b3VjaEFjdGl2ZSA9IHRydWU7XG4gIHRvdWNoUmVjb3JkLnN0YXJ0UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgdG91Y2hSZWNvcmQuc3RhcnRQYWdlWSA9IHRvdWNoLnBhZ2VZO1xuICB0b3VjaFJlY29yZC5zdGFydFRpbWVTdGFtcCA9IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKTtcbiAgdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VYID0gdG91Y2gucGFnZVg7XG4gIHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWSA9IHRvdWNoLnBhZ2VZO1xuICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VYID0gdG91Y2gucGFnZVg7XG4gIHRvdWNoUmVjb3JkLnByZXZpb3VzUGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgdG91Y2hSZWNvcmQucHJldmlvdXNUaW1lU3RhbXAgPSB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaCk7XG59XG5cbmZ1bmN0aW9uIGdldFRvdWNoSWRlbnRpZmllcihfcmVmKSB7XG4gIHZhciBpZGVudGlmaWVyID0gX3JlZi5pZGVudGlmaWVyO1xuXG4gIGlmIChpZGVudGlmaWVyID09IG51bGwpIHtcbiAgICBjb25zb2xlLmVycm9yKCdUb3VjaCBvYmplY3QgaXMgbWlzc2luZyBpZGVudGlmaWVyLicpO1xuICB9XG5cbiAgaWYgKF9fREVWX18pIHtcbiAgICBpZiAoaWRlbnRpZmllciA+IE1BWF9UT1VDSF9CQU5LKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdUb3VjaCBpZGVudGlmaWVyICVzIGlzIGdyZWF0ZXIgdGhhbiBtYXhpbXVtIHN1cHBvcnRlZCAlcyB3aGljaCBjYXVzZXMgJyArICdwZXJmb3JtYW5jZSBpc3N1ZXMgYmFja2ZpbGxpbmcgYXJyYXkgbG9jYXRpb25zIGZvciBhbGwgb2YgdGhlIGluZGljZXMuJywgaWRlbnRpZmllciwgTUFYX1RPVUNIX0JBTkspO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpZGVudGlmaWVyO1xufVxuXG5mdW5jdGlvbiByZWNvcmRUb3VjaFN0YXJ0KHRvdWNoKSB7XG4gIHZhciBpZGVudGlmaWVyID0gZ2V0VG91Y2hJZGVudGlmaWVyKHRvdWNoKTtcbiAgdmFyIHRvdWNoUmVjb3JkID0gdG91Y2hCYW5rW2lkZW50aWZpZXJdO1xuXG4gIGlmICh0b3VjaFJlY29yZCkge1xuICAgIHJlc2V0VG91Y2hSZWNvcmQodG91Y2hSZWNvcmQsIHRvdWNoKTtcbiAgfSBlbHNlIHtcbiAgICB0b3VjaEJhbmtbaWRlbnRpZmllcl0gPSBjcmVhdGVUb3VjaFJlY29yZCh0b3VjaCk7XG4gIH1cblxuICB0b3VjaEhpc3RvcnkubW9zdFJlY2VudFRpbWVTdGFtcCA9IHRpbWVzdGFtcEZvclRvdWNoKHRvdWNoKTtcbn1cblxuZnVuY3Rpb24gcmVjb3JkVG91Y2hNb3ZlKHRvdWNoKSB7XG4gIHZhciB0b3VjaFJlY29yZCA9IHRvdWNoQmFua1tnZXRUb3VjaElkZW50aWZpZXIodG91Y2gpXTtcblxuICBpZiAodG91Y2hSZWNvcmQpIHtcbiAgICB0b3VjaFJlY29yZC50b3VjaEFjdGl2ZSA9IHRydWU7XG4gICAgdG91Y2hSZWNvcmQucHJldmlvdXNQYWdlWCA9IHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWDtcbiAgICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VZID0gdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VZO1xuICAgIHRvdWNoUmVjb3JkLnByZXZpb3VzVGltZVN0YW1wID0gdG91Y2hSZWNvcmQuY3VycmVudFRpbWVTdGFtcDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICAgIHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlY29yZCB0b3VjaCBtb3ZlIHdpdGhvdXQgYSB0b3VjaCBzdGFydC5cXG4nLCBcIlRvdWNoIE1vdmU6IFwiICsgcHJpbnRUb3VjaCh0b3VjaCkgKyBcIlxcblwiLCBcIlRvdWNoIEJhbms6IFwiICsgcHJpbnRUb3VjaEJhbmsoKSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVjb3JkVG91Y2hFbmQodG91Y2gpIHtcbiAgdmFyIHRvdWNoUmVjb3JkID0gdG91Y2hCYW5rW2dldFRvdWNoSWRlbnRpZmllcih0b3VjaCldO1xuXG4gIGlmICh0b3VjaFJlY29yZCkge1xuICAgIHRvdWNoUmVjb3JkLnRvdWNoQWN0aXZlID0gZmFsc2U7XG4gICAgdG91Y2hSZWNvcmQucHJldmlvdXNQYWdlWCA9IHRvdWNoUmVjb3JkLmN1cnJlbnRQYWdlWDtcbiAgICB0b3VjaFJlY29yZC5wcmV2aW91c1BhZ2VZID0gdG91Y2hSZWNvcmQuY3VycmVudFBhZ2VZO1xuICAgIHRvdWNoUmVjb3JkLnByZXZpb3VzVGltZVN0YW1wID0gdG91Y2hSZWNvcmQuY3VycmVudFRpbWVTdGFtcDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVggPSB0b3VjaC5wYWdlWDtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50UGFnZVkgPSB0b3VjaC5wYWdlWTtcbiAgICB0b3VjaFJlY29yZC5jdXJyZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICAgIHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wID0gdGltZXN0YW1wRm9yVG91Y2godG91Y2gpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybignQ2Fubm90IHJlY29yZCB0b3VjaCBlbmQgd2l0aG91dCBhIHRvdWNoIHN0YXJ0LlxcbicsIFwiVG91Y2ggRW5kOiBcIiArIHByaW50VG91Y2godG91Y2gpICsgXCJcXG5cIiwgXCJUb3VjaCBCYW5rOiBcIiArIHByaW50VG91Y2hCYW5rKCkpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHByaW50VG91Y2godG91Y2gpIHtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHtcbiAgICBpZGVudGlmaWVyOiB0b3VjaC5pZGVudGlmaWVyLFxuICAgIHBhZ2VYOiB0b3VjaC5wYWdlWCxcbiAgICBwYWdlWTogdG91Y2gucGFnZVksXG4gICAgdGltZXN0YW1wOiB0aW1lc3RhbXBGb3JUb3VjaCh0b3VjaClcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHByaW50VG91Y2hCYW5rKCkge1xuICB2YXIgcHJpbnRlZCA9IEpTT04uc3RyaW5naWZ5KHRvdWNoQmFuay5zbGljZSgwLCBNQVhfVE9VQ0hfQkFOSykpO1xuXG4gIGlmICh0b3VjaEJhbmsubGVuZ3RoID4gTUFYX1RPVUNIX0JBTkspIHtcbiAgICBwcmludGVkICs9ICcgKG9yaWdpbmFsIHNpemU6ICcgKyB0b3VjaEJhbmsubGVuZ3RoICsgJyknO1xuICB9XG5cbiAgcmV0dXJuIHByaW50ZWQ7XG59XG5cbnZhciBSZXNwb25kZXJUb3VjaEhpc3RvcnlTdG9yZSA9IHtcbiAgcmVjb3JkVG91Y2hUcmFjazogZnVuY3Rpb24gcmVjb3JkVG91Y2hUcmFjayh0b3BMZXZlbFR5cGUsIG5hdGl2ZUV2ZW50KSB7XG4gICAgaWYgKCgwLCBfUmVzcG9uZGVyRXZlbnRUeXBlcy5pc01vdmVpc2gpKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIG5hdGl2ZUV2ZW50LmNoYW5nZWRUb3VjaGVzLmZvckVhY2gocmVjb3JkVG91Y2hNb3ZlKTtcbiAgICB9IGVsc2UgaWYgKCgwLCBfUmVzcG9uZGVyRXZlbnRUeXBlcy5pc1N0YXJ0aXNoKSh0b3BMZXZlbFR5cGUpKSB7XG4gICAgICBuYXRpdmVFdmVudC5jaGFuZ2VkVG91Y2hlcy5mb3JFYWNoKHJlY29yZFRvdWNoU3RhcnQpO1xuICAgICAgdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXMgPSBuYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aDtcblxuICAgICAgaWYgKHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzID09PSAxKSB7XG4gICAgICAgIHRvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2ggPSBuYXRpdmVFdmVudC50b3VjaGVzWzBdLmlkZW50aWZpZXI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICgoMCwgX1Jlc3BvbmRlckV2ZW50VHlwZXMuaXNFbmRpc2gpKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIG5hdGl2ZUV2ZW50LmNoYW5nZWRUb3VjaGVzLmZvckVhY2gocmVjb3JkVG91Y2hFbmQpO1xuICAgICAgdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXMgPSBuYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aDtcblxuICAgICAgaWYgKHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzID09PSAxKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG91Y2hCYW5rLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHRvdWNoVHJhY2tUb0NoZWNrID0gdG91Y2hCYW5rW2ldO1xuXG4gICAgICAgICAgaWYgKHRvdWNoVHJhY2tUb0NoZWNrICE9IG51bGwgJiYgdG91Y2hUcmFja1RvQ2hlY2sudG91Y2hBY3RpdmUpIHtcbiAgICAgICAgICAgIHRvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2ggPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgICB2YXIgYWN0aXZlUmVjb3JkID0gdG91Y2hCYW5rW3RvdWNoSGlzdG9yeS5pbmRleE9mU2luZ2xlQWN0aXZlVG91Y2hdO1xuXG4gICAgICAgICAgaWYgKCEoYWN0aXZlUmVjb3JkICE9IG51bGwgJiYgYWN0aXZlUmVjb3JkLnRvdWNoQWN0aXZlKSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ2Fubm90IGZpbmQgc2luZ2xlIGFjdGl2ZSB0b3VjaC4nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRvdWNoSGlzdG9yeTogdG91Y2hIaXN0b3J5XG59O1xudmFyIF9kZWZhdWx0ID0gUmVzcG9uZGVyVG91Y2hIaXN0b3J5U3RvcmU7XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDtcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cy5kZWZhdWx0OyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWkEsT0FBTyxDQUFDQyxVQUFVLEdBQUcsSUFBSTtBQUN6QkQsT0FBTyxDQUFDRSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBRXhCLElBQUlDLG9CQUFvQixHQUFHQyxPQUFPLHdCQUF3QixDQUFDO0FBZ0IzRCxJQUFJQyxPQUFPLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEtBQUssWUFBWTtBQUVuRCxJQUFJQyxjQUFjLEdBQUcsRUFBRTtBQUN2QixJQUFJQyxTQUFTLEdBQUcsRUFBRTtBQUNsQixJQUFJQyxZQUFZLEdBQUc7RUFDakJELFNBQVMsRUFBRUEsU0FBUztFQUNwQkUsbUJBQW1CLEVBQUUsQ0FBQztFQUl0QkMsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO0VBQzVCQyxtQkFBbUIsRUFBRTtBQUN2QixDQUFDO0FBRUQsU0FBU0MsaUJBQWlCQSxDQUFDQyxLQUFLLEVBQUU7RUFHaEMsT0FBT0EsS0FBSyxDQUFDQyxTQUFTLElBQUlELEtBQUssQ0FBQ0UsU0FBUztBQUMzQztBQU9BLFNBQVNDLGlCQUFpQkEsQ0FBQ0gsS0FBSyxFQUFFO0VBQ2hDLE9BQU87SUFDTEksV0FBVyxFQUFFLElBQUk7SUFDakJDLFVBQVUsRUFBRUwsS0FBSyxDQUFDTSxLQUFLO0lBQ3ZC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