7f96cedd0a3cd6270876a66c5422676a
"use strict";

exports.__esModule = true;
exports.default = void 0;
var React = _interopRequireWildcard(require("react"));
var _ExecutionEnvironment = require("fbjs/lib/ExecutionEnvironment");
var _View = _interopRequireDefault(require("../View"));
var _createElement = _interopRequireDefault(require("../createElement"));
var _StyleSheet = _interopRequireDefault(require("../StyleSheet"));
var _UIManager = _interopRequireDefault(require("../UIManager"));
function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}
function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();
  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };
  return cache;
}
function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }
  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }
  var cache = _getRequireWildcardCache();
  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }
  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }
  newObj.default = obj;
  if (cache) {
    cache.set(obj, newObj);
  }
  return newObj;
}
var FocusBracket = function FocusBracket() {
  return (0, _createElement.default)('div', {
    accessibilityRole: 'none',
    tabIndex: 0,
    style: styles.focusBracket
  });
};
function attemptFocus(element) {
  if (!_ExecutionEnvironment.canUseDOM) {
    return false;
  }
  try {
    element.focus();
  } catch (e) {}
  return document.activeElement === element;
}
function focusFirstDescendant(element) {
  for (var i = 0; i < element.childNodes.length; i++) {
    var child = element.childNodes[i];
    if (attemptFocus(child) || focusFirstDescendant(child)) {
      return true;
    }
  }
  return false;
}
function focusLastDescendant(element) {
  for (var i = element.childNodes.length - 1; i >= 0; i--) {
    var child = element.childNodes[i];
    if (attemptFocus(child) || focusLastDescendant(child)) {
      return true;
    }
  }
  return false;
}
var ModalFocusTrap = function ModalFocusTrap(_ref) {
  var active = _ref.active,
    children = _ref.children;
  var trapElementRef = React.useRef();
  var focusRef = React.useRef({
    trapFocusInProgress: false,
    lastFocusedElement: null
  });
  React.useEffect(function () {
    if (_ExecutionEnvironment.canUseDOM) {
      var trapFocus = function trapFocus() {
        if (trapElementRef.current == null || focusRef.current.trapFocusInProgress || !active) {
          return;
        }
        try {
          focusRef.current.trapFocusInProgress = true;
          if (document.activeElement instanceof Node && !trapElementRef.current.contains(document.activeElement)) {
            var hasFocused = focusFirstDescendant(trapElementRef.current);
            if (focusRef.current.lastFocusedElement === document.activeElement) {
              hasFocused = focusLastDescendant(trapElementRef.current);
            }
            if (!hasFocused && trapElementRef.current != null && document.activeElement) {
              _UIManager.default.focus(trapElementRef.current);
            }
          }
        } finally {
          focusRef.current.trapFocusInProgress = false;
        }
        focusRef.current.lastFocusedElement = document.activeElement;
      };
      trapFocus();
      document.addEventListener('focus', trapFocus, true);
      return function () {
        return document.removeEventListener('focus', trapFocus, true);
      };
    }
  }, [active]);
  React.useEffect(function () {
    if (_ExecutionEnvironment.canUseDOM) {
      var lastFocusedElementOutsideTrap = document.activeElement;
      return function () {
        if (lastFocusedElementOutsideTrap && document.contains(lastFocusedElementOutsideTrap)) {
          _UIManager.default.focus(lastFocusedElementOutsideTrap);
        }
      };
    }
  }, []);
  return React.createElement(React.Fragment, null, React.createElement(FocusBracket, null), React.createElement(_View.default, {
    ref: trapElementRef
  }, children), React.createElement(FocusBracket, null));
};
var _default = ModalFocusTrap;
exports.default = _default;
var styles = _StyleSheet.default.create({
  focusBracket: {
    outlineStyle: 'none'
  }
});
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBvcnRzIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJSZWFjdCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsIl9FeGVjdXRpb25FbnZpcm9ubWVudCIsIl9WaWV3IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsIl9jcmVhdGVFbGVtZW50IiwiX1N0eWxlU2hlZXQiLCJfVUlNYW5hZ2VyIiwib2JqIiwiX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlIiwiV2Vha01hcCIsImNhY2hlIiwiaGFzIiwiZ2V0IiwibmV3T2JqIiwiaGFzUHJvcGVydHlEZXNjcmlwdG9yIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwic2V0IiwiRm9jdXNCcmFja2V0IiwiYWNjZXNzaWJpbGl0eVJvbGUiLCJ0YWJJbmRleCIsInN0eWxlIiwic3R5bGVzIiwiZm9jdXNCcmFja2V0IiwiYXR0ZW1wdEZvY3VzIiwiZWxlbWVudCIsImNhblVzZURPTSIsImZvY3VzIiwiZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImZvY3VzRmlyc3REZXNjZW5kYW50IiwiaSIsImNoaWxkTm9kZXMiLCJsZW5ndGgiLCJjaGlsZCIsImZvY3VzTGFzdERlc2NlbmRhbnQiLCJNb2RhbEZvY3VzVHJhcCIsIl9yZWYiLCJhY3RpdmUiLCJjaGlsZHJlbiIsInRyYXBFbGVtZW50UmVmIiwidXNlUmVmIiwiZm9jdXNSZWYiLCJ0cmFwRm9jdXNJblByb2dyZXNzIiwibGFzdEZvY3VzZWRFbGVtZW50IiwidXNlRWZmZWN0IiwidHJhcEZvY3VzIiwiY3VycmVudCIsIk5vZGUiLCJjb250YWlucyIsImhhc0ZvY3VzZWQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImxhc3RGb2N1c2VkRWxlbWVudE91dHNpZGVUcmFwIiwiY3JlYXRlRWxlbWVudCIsIkZyYWdtZW50IiwicmVmIiwiX2RlZmF1bHQiLCJjcmVhdGUiLCJvdXRsaW5lU3R5bGUiLCJtb2R1bGUiXSwic291cmNlcyI6WyJNb2RhbEZvY3VzVHJhcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxudmFyIFJlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF9FeGVjdXRpb25FbnZpcm9ubWVudCA9IHJlcXVpcmUoXCJmYmpzL2xpYi9FeGVjdXRpb25FbnZpcm9ubWVudFwiKTtcblxudmFyIF9WaWV3ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vVmlld1wiKSk7XG5cbnZhciBfY3JlYXRlRWxlbWVudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4uL2NyZWF0ZUVsZW1lbnRcIikpO1xuXG52YXIgX1N0eWxlU2hlZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9TdHlsZVNoZWV0XCIpKTtcblxudmFyIF9VSU1hbmFnZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi9VSU1hbmFnZXJcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5mdW5jdGlvbiBfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUoKSB7IGlmICh0eXBlb2YgV2Vha01hcCAhPT0gXCJmdW5jdGlvblwiKSByZXR1cm4gbnVsbDsgdmFyIGNhY2hlID0gbmV3IFdlYWtNYXAoKTsgX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlID0gZnVuY3Rpb24gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCkgeyByZXR1cm4gY2FjaGU7IH07IHJldHVybiBjYWNoZTsgfVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGlmIChvYmogPT09IG51bGwgfHwgdHlwZW9mIG9iaiAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2Ygb2JqICE9PSBcImZ1bmN0aW9uXCIpIHsgcmV0dXJuIHsgZGVmYXVsdDogb2JqIH07IH0gdmFyIGNhY2hlID0gX2dldFJlcXVpcmVXaWxkY2FyZENhY2hlKCk7IGlmIChjYWNoZSAmJiBjYWNoZS5oYXMob2JqKSkgeyByZXR1cm4gY2FjaGUuZ2V0KG9iaik7IH0gdmFyIG5ld09iaiA9IHt9OyB2YXIgaGFzUHJvcGVydHlEZXNjcmlwdG9yID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBoYXNQcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IG51bGw7IGlmIChkZXNjICYmIChkZXNjLmdldCB8fCBkZXNjLnNldCkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IGlmIChjYWNoZSkgeyBjYWNoZS5zZXQob2JqLCBuZXdPYmopOyB9IHJldHVybiBuZXdPYmo7IH1cblxuLyoqXG4gKiBDb3B5cmlnaHQgKGMpIE5pY29sYXMgR2FsbGFnaGVyLlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogXG4gKi9cblxuLyoqXG4gKiBUaGlzIENvbXBvbmVudCBpcyB1c2VkIHRvIFwid3JhcFwiIHRoZSBtb2RhbCB3ZSdyZSBvcGVuaW5nXG4gKiBzbyB0aGF0IGNoYW5naW5nIGZvY3VzIHZpYSB0YWIgd2lsbCBuZXZlciBsZWF2ZSB0aGUgZG9jdW1lbnQuXG4gKlxuICogVGhpcyBhbGxvd3MgdXMgdG8gcHJvcGVybHkgdHJhcCB0aGUgZm9jdXMgd2l0aGluIGEgbW9kYWxcbiAqIGV2ZW4gaWYgdGhlIG1vZGFsIGlzIGF0IHRoZSBzdGFydCBvciBlbmQgb2YgYSBkb2N1bWVudC5cbiAqL1xudmFyIEZvY3VzQnJhY2tldCA9IGZ1bmN0aW9uIEZvY3VzQnJhY2tldCgpIHtcbiAgcmV0dXJuICgwLCBfY3JlYXRlRWxlbWVudC5kZWZhdWx0KSgnZGl2Jywge1xuICAgIGFjY2Vzc2liaWxpdHlSb2xlOiAnbm9uZScsXG4gICAgdGFiSW5kZXg6IDAsXG4gICAgc3R5bGU6IHN0eWxlcy5mb2N1c0JyYWNrZXRcbiAgfSk7XG59O1xuXG5mdW5jdGlvbiBhdHRlbXB0Rm9jdXMoZWxlbWVudCkge1xuICBpZiAoIV9FeGVjdXRpb25FbnZpcm9ubWVudC5jYW5Vc2VET00pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICB0cnkge1xuICAgIGVsZW1lbnQuZm9jdXMoKTtcbiAgfSBjYXRjaCAoZSkgey8vIERvIG5vdGhpbmdcbiAgfVxuXG4gIHJldHVybiBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBlbGVtZW50O1xufVxuXG5mdW5jdGlvbiBmb2N1c0ZpcnN0RGVzY2VuZGFudChlbGVtZW50KSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGNoaWxkID0gZWxlbWVudC5jaGlsZE5vZGVzW2ldO1xuXG4gICAgaWYgKGF0dGVtcHRGb2N1cyhjaGlsZCkgfHwgZm9jdXNGaXJzdERlc2NlbmRhbnQoY2hpbGQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGZvY3VzTGFzdERlc2NlbmRhbnQoZWxlbWVudCkge1xuICBmb3IgKHZhciBpID0gZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgdmFyIGNoaWxkID0gZWxlbWVudC5jaGlsZE5vZGVzW2ldO1xuXG4gICAgaWYgKGF0dGVtcHRGb2N1cyhjaGlsZCkgfHwgZm9jdXNMYXN0RGVzY2VuZGFudChjaGlsZCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cblxudmFyIE1vZGFsRm9jdXNUcmFwID0gZnVuY3Rpb24gTW9kYWxGb2N1c1RyYXAoX3JlZikge1xuICB2YXIgYWN0aXZlID0gX3JlZi5hY3RpdmUsXG4gICAgICBjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47XG4gIHZhciB0cmFwRWxlbWVudFJlZiA9IFJlYWN0LnVzZVJlZigpO1xuICB2YXIgZm9jdXNSZWYgPSBSZWFjdC51c2VSZWYoe1xuICAgIHRyYXBGb2N1c0luUHJvZ3Jlc3M6IGZhbHNlLFxuICAgIGxhc3RGb2N1c2VkRWxlbWVudDogbnVsbFxuICB9KTtcbiAgUmVhY3QudXNlRWZmZWN0KGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoX0V4ZWN1dGlvbkVudmlyb25tZW50LmNhblVzZURPTSkge1xuICAgICAgdmFyIHRyYXBGb2N1cyA9IGZ1bmN0aW9uIHRyYXBGb2N1cygpIHtcbiAgICAgICAgLy8gV2Ugc2hvdWxkIG5vdCB0cmFwIGZvY3VzIGlmOlxuICAgICAgICAvLyAtIFRoZSBtb2RhbCBoYXNuJ3QgZnVsbHkgaW5pdGlhbGl6ZWQgd2l0aCBhbiBIVE1MRWxlbWVudCByZWZcbiAgICAgICAgLy8gLSBGb2N1cyBpcyBhbHJlYWR5IGluIHRoZSBwcm9jZXNzIG9mIGJlaW5nIHRyYXBwZWQgKGUuZy4sIHdlJ3JlIHJlZm9jdXNpbmcpXG4gICAgICAgIC8vIC0gaXNUcmFwQWN0aXZlIHByb3AgYmVpbmcgZmFsc2V5IHRlbGxzIHVzIHRvIGRvIG5vdGhpbmdcbiAgICAgICAgaWYgKHRyYXBFbGVtZW50UmVmLmN1cnJlbnQgPT0gbnVsbCB8fCBmb2N1c1JlZi5jdXJyZW50LnRyYXBGb2N1c0luUHJvZ3Jlc3MgfHwgIWFjdGl2ZSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZm9jdXNSZWYuY3VycmVudC50cmFwRm9jdXNJblByb2dyZXNzID0gdHJ1ZTtcblxuICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgTm9kZSAmJiAhdHJhcEVsZW1lbnRSZWYuY3VycmVudC5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KSkge1xuICAgICAgICAgICAgLy8gVG8gaGFuZGxlIGtleWJvYXJkIGZvY3VzaW5nIHdlIGNhbiBtYWtlIGFuIGFzc3VtcHRpb24gaGVyZS5cbiAgICAgICAgICAgIC8vIElmIHlvdSdyZSB0YWJiaW5nIHRocm91Z2ggdGhlIGZvY3VzYWJsZSBlbGVtZW50cywgdGhlIHByZXZpb3VzbHlcbiAgICAgICAgICAgIC8vIGFjdGl2ZSBlbGVtZW50IHdpbGwgZWl0aGVyIGJlIHRoZSBmaXJzdCBvciB0aGUgbGFzdC5cbiAgICAgICAgICAgIC8vIElmIHRoZSBwcmV2aW91c2x5IHNlbGVjdGVkIGVsZW1lbnQgaXMgdGhlIFwiZmlyc3RcIiBkZXNjZW5kYW50XG4gICAgICAgICAgICAvLyBhbmQgd2UncmUgbGVhdmluZyBpdCAtIHRoaXMgbWVhbnMgdGhhdCB3ZSBzaG91bGQgYmUgbG9vcGluZ1xuICAgICAgICAgICAgLy8gYXJvdW5kIHRvIHRoZSBvdGhlciBzaWRlIG9mIHRoZSBtb2RhbC5cbiAgICAgICAgICAgIHZhciBoYXNGb2N1c2VkID0gZm9jdXNGaXJzdERlc2NlbmRhbnQodHJhcEVsZW1lbnRSZWYuY3VycmVudCk7XG5cbiAgICAgICAgICAgIGlmIChmb2N1c1JlZi5jdXJyZW50Lmxhc3RGb2N1c2VkRWxlbWVudCA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICAgICAgICBoYXNGb2N1c2VkID0gZm9jdXNMYXN0RGVzY2VuZGFudCh0cmFwRWxlbWVudFJlZi5jdXJyZW50KTtcbiAgICAgICAgICAgIH0gLy8gSWYgd2UgY291bGRuJ3QgZm9jdXMgYSBuZXcgZWxlbWVudCB0aGVuIHdlIG5lZWQgdG8gZm9jdXMgb250byB0aGUgdHJhcCB0YXJnZXRcblxuXG4gICAgICAgICAgICBpZiAoIWhhc0ZvY3VzZWQgJiYgdHJhcEVsZW1lbnRSZWYuY3VycmVudCAhPSBudWxsICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgX1VJTWFuYWdlci5kZWZhdWx0LmZvY3VzKHRyYXBFbGVtZW50UmVmLmN1cnJlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICBmb2N1c1JlZi5jdXJyZW50LnRyYXBGb2N1c0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvY3VzUmVmLmN1cnJlbnQubGFzdEZvY3VzZWRFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAgIH07IC8vIENhbGwgdGhlIHRyYXBGb2N1cyBjYWxsYmFjayBhdCBsZWFzdCBvbmNlIHdoZW4gdGhpcyBtb2RhbCBoYXMgYmVlbiBhY3RpdmF0ZWQuXG5cblxuICAgICAgdHJhcEZvY3VzKCk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRyYXBGb2N1cywgdHJ1ZSk7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0cmFwRm9jdXMsIHRydWUpO1xuICAgICAgfTtcbiAgICB9XG4gIH0sIFthY3RpdmVdKTsgLy8gVG8gYmUgZnVsbHkgY29tcGxpYW50IHdpdGggV0NBRyB3ZSBuZWVkIHRvIHJlZm9jdXMgZWxlbWVudCB0aGF0IHRyaWdnZXJlZCBvcGVuaW5nIG1vZGFsXG4gIC8vIGFmdGVyIGNsb3NpbmcgaXRcblxuICBSZWFjdC51c2VFZmZlY3QoZnVuY3Rpb24gKCkge1xuICAgIGlmIChfRXhlY3V0aW9uRW52aXJvbm1lbnQuY2FuVXNlRE9NKSB7XG4gICAgICB2YXIgbGFzdEZvY3VzZWRFbGVtZW50T3V0c2lkZVRyYXAgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGxhc3RGb2N1c2VkRWxlbWVudE91dHNpZGVUcmFwICYmIGRvY3VtZW50LmNvbnRhaW5zKGxhc3RGb2N1c2VkRWxlbWVudE91dHNpZGVUcmFwKSkge1xuICAgICAgICAgIF9VSU1hbmFnZXIuZGVmYXVsdC5mb2N1cyhsYXN0Rm9jdXNlZEVsZW1lbnRPdXRzaWRlVHJhcCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9LCBbXSk7XG4gIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9jdXNCcmFja2V0LCBudWxsKSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoX1ZpZXcuZGVmYXVsdCwge1xuICAgIHJlZjogdHJhcEVsZW1lbnRSZWZcbiAgfSwgY2hpbGRyZW4pLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb2N1c0JyYWNrZXQsIG51bGwpKTtcbn07XG5cbnZhciBfZGVmYXVsdCA9IE1vZGFsRm9jdXNUcmFwO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5cbnZhciBzdHlsZXMgPSBfU3R5bGVTaGVldC5kZWZhdWx0LmNyZWF0ZSh7XG4gIGZvY3VzQnJhY2tldDoge1xuICAgIG91dGxpbmVTdHlsZTogJ25vbmUnXG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHMuZGVmYXVsdDsiXSwibWFwcGluZ3MiOiJBQUFBLFlBQVk7O0FBRVpBLE9BQU8sQ0FBQ0MsVUFBVSxHQUFHLElBQUk7QUFDekJELE9BQU8sQ0FBQ0UsT0FBTyxHQUFHLEtBQUssQ0FBQztBQUV4QixJQUFJQyxLQUFLLEdBQUdDLHVCQUF1QixDQUFDQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFckQsSUFBSUMscUJBQXFCLEdBQUdELE9BQU8sQ0FBQywrQkFBK0IsQ0FBQztBQUVwRSxJQUFJRSxLQUFLLEdBQUdDLHNCQUFzQixDQUFDSCxPQUFPLFVBQVUsQ0FBQyxDQUFDO0FBRXRELElBQUlJLGNBQWMsR0FBR0Qsc0JBQXNCLENBQUNILE9BQU8sbUJBQW1CLENBQUMsQ0FBQztBQUV4RSxJQUFJSyxXQUFXLEdBQUdGLHNCQUFzQixDQUFDSCxPQUFPLGdCQUFnQixDQUFDLENBQUM7QUFFbEUsSUFBSU0sVUFBVSxHQUFHSCxzQkFBc0IsQ0FBQ0gsT0FBTyxlQUFlLENBQUMsQ0FBQztBQUVoRSxTQUFTRyxzQkFBc0JBLENBQUNJLEdBQUcsRUFBRTtFQUFFLE9BQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDWCxVQUFVLEdBQUdXLEdBQUcsR0FBRztJQUFFVixPQUFPLEVBQUVVO0VBQUksQ0FBQztBQUFFO0FBRTlGLFNBQVNDLHdCQUF3QkEsQ0FBQSxFQUFHO0VBQUUsSUFBSSxPQUFPQyxPQUFPLEtBQUssVUFBVSxFQUFFLE9BQU8sSUFBSTtFQUFFLElBQUlDLEtBQUssR0FBRyxJQUFJRCxPQUFPLENBQUMsQ0FBQztFQUFFRCx3QkFBd0IsR0FBRyxTQUFTQSx3QkFBd0JBLENBQUEsRUFB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